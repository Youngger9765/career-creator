# 線上牌卡系統 PRD

## 產品概述

**產品名稱**：線上牌卡諮詢系統
**目標用戶**：職涯諮詢師與其來訪者
**核心價值**：將實體牌卡數位化，支援遠距諮詢與資料累積

## 🎯 當前狀態（2025-11-21）

**專案階段**: 第3個月 - Beta 測試準備期
**主要里程碑**:

- ✅ MVP 核心功能完成（9月）
- ✅ 資料持久化與白名單認證（10月）
- ✅ 負載測試與基礎設施優化（11月前半）
- ✅ 程式碼品質與 CI/CD 優化（11月中）
- ⚠️ 牌卡內容完整上架（進行中）
- 🎯 Beta 測試啟動（12月目標）

## 📚 相關文件

- [第一個月報告](https://docs.google.com/document/d/1p327JR-X3XeUxIKgkRZZfVXEWid_lTG4_rq0rVTAVuQ/edit) - 2025-09-01 ~ 09-30
- [第二個月需求](https://docs.google.com/document/d/1vSz-w5ST-hQKcZ85ALZlOF-AcxHzVt6bSWvzitH4_X4/edit) - 2025-10-01 ~ 10-31

---

## 🚧 待完成工作（優先順序）

### P0 - 阻擋 Beta 測試的必要項目

#### 1. 牌卡內容完整上架 ⚠️

**當前狀態**: 僅職業卡 100 張、RIASEC 6 張有圖片，其他牌組缺失

**需要完成**:

- ❌ **職能盤點卡**圖片與文案（等 Hannah 提供）
- ❌ **價值導航卡**圖片與文案（等 Hannah 提供）
- ❌ **職游旅人卡**其他缺失圖片
- ❌ 所有牌卡完整文案導入（目前僅測試資料）
- ⚠️ **CRM 牌卡介面三版展示**（小=文字、中=預覽、大=原圖）- 部分完成

**技術準備**: ✅ GCS 整合完成、✅ Fallback 機制完成

#### 2. 資料庫搬遷至公司 Supabase ❌

**當前狀態**: Staging/Production 使用臨時資料庫

**需要完成**:

- ❌ 搬遷 Staging 資料庫至公司 Supabase
- ❌ 搬遷 Production 資料庫至公司 Supabase
- ❌ 更新所有環境變數與連線設定
- ❌ 驗證資料完整性與功能正常運作

---

### P1 - Beta 測試後必要的優化項目

#### 1. 諮詢歷史管理完善 ❌

**當前狀態**: 基礎 CRM + 筆記功能已完成，但缺乏歷史查看介面

**需要完成**:

- ❌ 完整諮詢記錄查看介面（時間軸 + 篩選）
- ❌ 歷史資料匯出功能（CSV/PDF）
- ❌ 諮詢報告生成（基礎版，不含 AI）

**已完成基礎**:

- ✅ 即時筆記
- ✅ 截圖整合
- ✅ 遊戲狀態自動保存
- ✅ 客戶管理介面

#### 2. 訪客流程優化 ⚠️

**當前狀態**: 基礎功能可用，但體驗待完善

**需要完成**:

- ⚠️ 訪客引導流程優化
- ⚠️ 錯誤處理強化（斷線重連、權限提示）
- ⚠️ 訪客端效能優化

#### 3. 監控與錯誤追蹤 ⚠️

**當前狀態**: Cloud Logging 基礎設定存在，但未完善

**需要完成**:

- ⚠️ Cloud Logging 完整設定與 Dashboard
- ⚠️ 錯誤告警機制（Slack/Email）
- ⚠️ 效能監控指標建立

---

### P2 - 第二階段規劃（2025-12 ~ 2026-02）

> **合約期**: 第二期合約（12月～隔年2月）

#### 1. A+B=C Pattern 邏輯 ❌

**依賴**: 等 KM 提供 Pattern 文件

**需求**:

- ❌ Pattern 規則分析與設計
- ❌ 固定規則實作
- ❌ 遊戲引擎整合

#### 2. 註冊流程優化 ❌

**當前狀態**: 白名單制，無公開註冊

**需要完成**:

- ❌ 完整註冊機制（Email 驗證）
- ❌ 忘記密碼功能完善（目前已有基礎）
- ❌ OAuth 社群登入（預留）

**已完成**:

- ✅ 白名單認證系統
- ✅ 強制修改密碼機制
- ✅ 密碼重設 Token 機制

#### 3. AI 諮詢輔助功能 ❌

**範圍**: 延至第三階段

**計畫功能**:

- ❌ 智慧牌卡推薦
- ❌ 諮詢洞察分析（AI 分析牌卡選擇模式）
- ❌ 自動生成諮詢摘要

#### 4. 班級管理系統 ❌

**計畫功能**:

- ❌ 多人同時諮詢
- ❌ 群組管理功能
- ❌ 批量報告生成

#### 5. 用戶自定義內容 ❌

**計畫功能**:

- ❌ 自訂牌卡內容
- ❌ 自訂玩法規則
- ❌ 個人化牌組管理

> **「多副牌卡」定義**: 同一玩法規則下，用戶可自定義牌卡內容（如自創職業卡、自訂價值觀卡等）。MVP 階段僅提供官方預設牌卡內容。

---

## ✅ 已完成功能（高層次摘要）

### 第1個月 (2025-09)

- ✅ MVP 核心功能（註冊登入、房間管理、牌卡操作）
- ✅ 三種牌卡七大玩法
- ✅ Supabase Realtime 即時同步
- ✅ 客戶管理系統（CRM 基礎版）

### 第2個月 (2025-10)

- ✅ 牌卡視覺優化（疊卡模式、雙視圖）
- ✅ 遊戲狀態持久化（JSONB + localStorage 雙軌）
- ✅ 諮詢師筆記功能（即時筆記 + 截圖整合）
- ✅ 客戶諮詢室簡化（一鍵進入）
- ✅ 白名單認證系統（管理員後台、CSV 匯入、密碼重設）
- ✅ 籌碼系統改版（+/- 按鈕、手動輸入、獨立設定）
- ✅ Production 環境建置（GCP Cloud Run + Supabase）

### 第3個月前半 (2025-11/01 ~ 11/04)

- ✅ 負載測試框架（50 併發測試）
- ✅ 資料庫連線池優化（100% 成功率、響應時間優化 97%）
- ✅ 安全性強化（gitleaks 規則、移除 hardcoded keys）
- ✅ 牌卡圖片整合（100 張職業卡、RIASEC 6 張）

### 第3個月中 (2025-11/04 ~ 11/21)

- ✅ 牌卡 UI 優化（圓角、圖片顯示模式、Dark mode）
- ✅ E2E 測試完善（移除過時測試、CI/CD 整合）
- ✅ 效能優化（Realtime 頻寬 -60%、Hook 清理）
- ✅ 程式碼品質提升（TypeScript 型別、移除過時程式碼）
- ✅ CI/CD 優化（Docker Buildx 快取、依賴快取、智能健康檢查）
- ✅ Docker 優化（Multi-stage build、Non-root user、-25% 映像大小）
- ✅ 文件整理（移除過時文件 1314 行）

---

## 🎮 系統架構（簡要說明）

### 用戶角色

- **諮詢師**: 白名單註冊、創建房間、管理客戶
- **來訪者**: 免註冊、透過連結進入、暱稱即可使用

### 核心功能

- **房間系統**: 創建/分享（QR Code）、7天過期機制
- **即時同步**: Supabase Realtime（游標、牌卡狀態、文字輸入）
- **遊戲引擎**: 三大牌組、七種玩法、通用規則引擎
- **CRM**: 客戶資訊、諮詢歷程、時間軸
- **筆記**: 即時筆記、截圖整合、遊戲狀態自動保存

### 技術棧

- **Frontend**: Next.js 14, TypeScript, Tailwind CSS, @dnd-kit
- **Backend**: FastAPI, Python 3.11, SQLModel
- **Database**: PostgreSQL (Supabase)
- **Storage**: GCP Cloud Storage
- **Deployment**: GCP Cloud Run
- **CI/CD**: GitHub Actions

---

## 🃏 牌卡系統（七種玩法）

### 三大模式架構

**1. 職游旅人卡**

- **六大性格分析**: RIASEC 6 張解釋卡 + 100 張職業卡，三欄分類（喜歡/中立/討厭）
- **職業收藏家**: 從 100 張職業卡精選最多 15 張

**2. 職能盤點卡**

- **優劣勢分析**: 雙區畫布（優勢/劣勢各 5 張）
- **成長計畫**: A 職能卡 + B 技能卡，三區畫布
- **職位拆解**: 自由排列 + JD 截圖上傳

**3. 價值導航卡**

- **價值觀排序**: 36 張核心價值卡，分層排序（前三名 + 其他）
- **生活改造王**: 籌碼分配系統（100 點能量），滿意度量表 + 投資分配

### 基礎操作

- **翻牌**: 點擊切換正反面
- **拖曳**: 從牌組拖到放置區
- **查看**: 長按/雙擊查看詳情
- **註記**: 諮詢師可加註解

---

## 📝 版本紀錄

- **v6.0** (2025-11-21): 🔄 PRD 大重構 - 聚焦未完成工作
  - 📋 新增「待完成工作」優先順序分類（P0/P1/P2）
  - ✅ 簡化已完成功能為高層次摘要（月份總結）
  - 🎯 重點突出：牌卡內容上架、資料庫搬遷等 P0 項目
  - 🗑️ 移除 1600+ 行詳細時程追蹤（保留高層次里程碑）
  - 📊 更新至 11/21：CI/CD 優化、Docker 優化、文件整理完成

- **v5.0** (2025-11-04): 負載測試與資料庫連線池優化
  - ✅ 50 併發測試 100% 成功率、響應時間優化 97%
  - ✅ 安全性強化、牌卡圖片整合（100 張職業卡 + RIASEC 6 張）

- **v4.9** (2025-10-28): Production 環境遷移與程式碼品質提升
  - ✅ GCP 遷移至公司專案、大型組件重構、測試覆蓋完善

- **v4.8** (2025-10-21): 白名單認證系統完整實作
  - ✅ 管理員後台、CSV 匯入、密碼重設機制

---

## 📋 重要會議記錄

### 2025-10-15 專案方向會議

**參與者**: KM, Young

**關鍵決議**:

1. **Beta 測試時程**: 11-12 月上線
2. **第一階段範圍**（至 11 月底）:
   - ✅ 籌碼系統改版
   - ✅ 白名單登入制
   - ⚠️ 牌卡內容上架（等 Hannah）
   - ❌ 資料庫搬遷至公司 Supabase
3. **不納入第一階段**: AI 報告生成、A+B=C Pattern、公開註冊
4. **第二階段**（12 月～2 月）: A+B=C Pattern、註冊流程、UX 優化

---

**文件更新**: 2025-11-21 | 版本: v6.0
