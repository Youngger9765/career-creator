# 線上牌卡系統 PRD - 專案管理紀錄

## 產品概述

**產品名稱**：線上牌卡諮詢系統
**目標用戶**：職涯諮詢師與其來訪者
**核心價值**：將實體牌卡數位化，支援遠距諮詢與資料累積

## 📚 相關文件連結

- **[第一個月進度報告]** - 詳細記錄第一個月（2025-09-01 ~ 09-30）
  完成項目與技術決策
  <https://docs.google.com/document/d/1p327JR-X3XeUxIKgkRZZfVXEWid_lTG4_rq0rVTAVuQ/edit>
- **[第二個月目標與需求]** - 第二個月（2025-10-01 ~ 10-31）
  詳細需求規格與期望目標
  <https://docs.google.com/document/d/1vSz-w5ST-hQKcZ85ALZlOF-AcxHzVt6bSWvzitH4_X4/edit>

## 🎯 三階段開發計畫

### 第1個月：MVP 核心功能

**目標**：建立可運作的原型系統

#### 必須完成 ✅

1. **諮詢師註冊登入** ✅ 已完成
2. **創建與管理房間** ✅ 已完成
3. **牌卡基本操作（翻牌、拖曳）** ✅ 已完成
4. **分享房間連結** ✅ 已完成
5. **即時同步機制** ✅ 已完成 (Supabase Realtime)
6. **三種牌卡七大玩法** ✅ 已完成

#### 未完成 ❌

1. **訪客流程優化** ⚠️ 部分完成

### 第2個月：資料持久化與諮詢功能

**目標**：完整的諮詢記錄與數據累積

#### 必須完成

1. **牌卡視覺體驗優化** ✅
   - ✅ 疊卡模式設計（放大單卡，犧牲廣度）
   - ✅ 50-100張牌卡的顯示優化
   - ✅ 拖曳選擇模式的畫面重新設計
   - ✅ 平衡單卡檢視與多卡瀏覽的需求

2. **牌卡狀態持久化** ✅ (2025-10-14 完成)
   - ✅ gameplay_states 表設計 (JSONB 存儲)
   - ✅ 自動保存機制 (30 秒間隔 + unmount)
   - ✅ 房間狀態恢復功能
   - ✅ Room owner → PostgreSQL, Visitor → localStorage
   - ✅ 支援多玩法狀態獨立保存
   - ❌ Event Sourcing 架構 (簡化為 snapshot 模式)

3. **牌卡內容上架** ⚠️ (部分完成 2025-11-04)
   - ⚠️ 真實牌卡文案導入（僅測試資料）
   - ✅ 牌卡圖片資源上傳（RIASEC 6張，2025-11-04）
   - ✅ 圖片資產管理系統建置（GCS + TypeScript）
   - ✅ 前端 graceful fallback 支援（有圖顯圖，無圖顯文字）
   - ❌ 其他牌組圖片（職游旅人卡、職能盤點卡、價值導航卡）
   - ❌ 內容管理系統建置

4. **諮詢師筆記功能** ✅
   - **✅ 選項A：手動筆記系統**（已選擇並完成）
     - ✅ 諮詢過程即時筆記
     - ⚠️ 筆記分類與標籤（基礎版）
     - ⚠️ 重要時刻標記（待完善）
   - **選項B：AI 分析系統**（留待第3個月）
     - 根據牌卡結果自動分析
     - 智慧洞察生成
     - 建議與解讀輔助

5. **諮詢歷史管理** ❌
   - ❌ 完整諮詢記錄查看
   - ❌ 歷史資料匯出
   - ❌ 諮詢報告生成

6. **客戶諮詢室架構簡化** ✅ (2025-10-11 新增，2025-10-12 完成)
   - ✅ 簡化客戶管理介面，移除展開式房間列表
   - ✅ 一鍵進入諮詢室功能（自動創建預設房間）
   - ✅ 截圖功能整合至諮詢筆記抽屜
   - ✅ 自動建立諮詢記錄（screenshots + game_state）
   - ✅ Room API 返回客戶關聯資訊（client_id, client_name）
   - ✅ 資料庫 Schema 更新（counselor_id 統一為 UUID）
   - 詳細規格：[SPEC_CLIENT_ROOM_SIMPLIFICATION.md](docs/SPEC_CLIENT_ROOM_SIMPLIFICATION.md)

### 第3個月：AI 輔助與進階功能

**目標**：智慧化輔助與規模化

#### 計畫功能

1. **AI 諮詢輔助**
   - 智慧牌卡推薦
   - 諮詢洞察分析
   - 自動生成諮詢摘要

2. **班級管理系統**
   - 多人同時諮詢
   - 群組管理功能
   - 批量報告生成

3. **用戶自定義內容**
   - 自訂牌卡內容
   - 自訂玩法規則
   - 個人化牌組管理

> **「多副牌卡」定義說明**：指在同一規則下，讓用戶可以自定義牌卡內容（如自創職業卡、自訂價值觀卡等）。MVP階段僅提供官方預設牌卡內容。
>
> **範圍調整**：三種牌卡玩法規則會全部實現，但每種規則只提供官方版本的牌卡內容，用戶自定義牌卡功能留待後續開發。

## 用戶系統架構

### 簡化架構（MVP採用）

```text
諮詢師
├── 需要註冊（Email + 密碼）
├── 可創建多個房間
└── 可查看歷史紀錄

來訪者
├── 免註冊
├── 透過連結進入
└── 輸入暱稱即可使用
```

## 🚀 目前實作狀態（2025-09-30）

### ✅ 已完成功能

1. **用戶系統** ✅
   - 諮詢師註冊/登入 (JWT)
   - Demo 帳號測試
   - 權限管理

2. **房間系統** ✅
   - 房間 CRUD 操作
   - QR Code 分享
   - 7天自動過期機制

3. **即時同步** ✅ (第2個月需求提前完成)
   - Supabase Realtime Broadcast
   - 游標同步顯示
   - 卡片移動同步
   - 卡片正反面同步

4. **遊戲引擎** ✅
   - 三大牌組完整實作
   - 七種玩法全部運作
   - 通用規則引擎

5. **客戶管理 (CRM)** ✅ (第2個月需求提前完成)
   - 來訪者基本資訊紀錄
   - 諮詢歷程追蹤
   - 時間軸檢視

### ❌ 待實作功能

1. **諮詢記錄進階功能**
   - 諮詢報告生成
   - 歷史諮詢查詢介面

2. **生產環境優化**
   - 訪客流程完善
   - 錯誤處理強化
   - 效能優化

## 頁面架構

### URL結構（詳細需求版）

```text
# 基本頁面
/                           # 首頁 / 登入畫面
/login                      # 諮詢師登入
/register                   # 諮詢師註冊
/dashboard                  # 諮詢列表 / 房間管理

# 房間系統
/rooms/create              # 新增房間
/room/[roomId]             # 房間（諮詢詳情）
/room/[roomId]?visitor=true&name=小明    # 來訪者進入

# 未來擴展（目前不實作）
/sessions                  # 諮詢列表（等同 /dashboard）
/sessions/<session_id>     # 諮詢詳情（等同 /room/[roomId]）
/sessions/<session_id>/decks/<deck_id>/plays/<play_id>  # 遊戲階層
```

### 網域架構（目標架構 vs 目前實作）

**目標架構：**

```text
第一層：諮詢師 (https://careercreator.tw/counselor1)
第二層：空間 (https://careercreator.tw/counselor1/room1)
第三層：牌卡 (https://careercreator.tw/counselor1/room1/card1)
第四層：玩法 (https://careercreator.tw/counselor1/room1/card1/play1)
```

**目前 MVP 實作：**

```text
# 簡化為單層結構，所有諮詢師共用同一個域名
/room/[roomId]  # 直接房間 ID，內建權限控制
```

**實作差異說明：**

- 目前採用簡化架構，不區分諮詢師子域名
- 權限透過登入狀態和房間創建者來控制
- 牌卡和玩法整合在房間內，不獨立分層

## 房間管理邏輯

### 房間生命週期

1. **創建**：諮詢師創建，獲得唯一ID
2. **分享**：生成短連結 + QR Code
3. **活躍**：有人在房間內操作
4. **閒置**：無人操作但仍可訪問
5. **過期**：超過有效期（預設7天）

### 權限管理

```javascript
諮詢師（房間創建者）
- 所有操作權限
- 可清空畫面
- 可結束房間

來訪者（透過連結加入）
- 可操作牌卡
- 可查看內容
- 無法刪除房間
```

## 牌卡操作功能

### 🎯 三大模式九種玩法（完整架構）

> **技術決策說明**：採用**三層通用規則引擎架構**，實現3大模式共9種玩法。參考iGaming行業最佳實踐，新玩法上線只需數天而非數週。

## 🎮 整體架構層級圖

```text
遊戲系統
│
├─ 模式選擇 (Mode)
│   ├─ 玩法選擇 (Gameplay)
│   │   ├─ 牌卡配置 (Auto)
│   │   └─ 畫布布局 (Auto)
│   └─ ...
```

## 🃏 三大模式詳細架構

### 1. 職游旅人卡模式

```text
職游旅人卡
├─ 六大性格分析
│   ├─ 6張解釋卡 (R/I/A/S/E/C)
│   └─ 三欄畫布 (喜歡/中立/討厭)
└─ 職業收藏家
    ├─ 100張職業卡
    └─ 單一收藏區 (最多15張精選)
```

#### 1.1 六大性格分析

**牌組構成**: 解釋卡6張 + 職業卡100張
**操作區域**: 三列分類區
**分類標準**: 喜歡 / 中立 / 討厭

**遊戲流程：**

1. **準備階段**: 諮詢師展示6張解釋卡，說明六大性格類型
2. **探索階段**: 來訪者從100張職業卡中選擇並分類
3. **討論階段**: 針對「喜歡」和「討厭」的職業深入對話
4. **總結階段**: 分析性格偏好與職涯方向的關聯

**區域限制：**

- 喜歡區：最多20張
- 中立區：無限制
- 討厭區：最多20張

#### 1.2 職業收藏家

**諮詢目標**: 幫助來訪者建立職業探索清單
**操作邏輯**: 從100張職業卡中精選最感興趣的15張
**畫布設計**: 單一收藏區，類似收藏夾概念

### 2. 職能盤點卡模式

```text
職能盤點卡
├─ 優劣勢分析
│   ├─ 單一職能卡組
│   └─ 雙區畫布 (優勢/劣勢)
├─ 成長計畫
│   ├─ 雙卡組 (A職能+B技能)
│   └─ 三區畫布 (A區+B區+文字註記)
└─ 職位拆解
    ├─ 單一職能卡組
    └─ 大型畫布 (自由排列+截圖上傳)
```

#### 2.1 優劣勢分析（原有）

- 左側：堆疊牌組
- 右側：兩個區域（優勢5張/劣勢5張）
- 拖曳牌卡到對應區域
- 顯示計數器（如：3/5）

#### 2.2 成長計畫

**諮詢目標**: 制定職涯發展路徑和技能提升計畫
**牌卡配置**: A組職能卡 + B組技能卡
**畫布設計**: 三區域（現有職能/目標技能/行動計畫）

#### 2.3 職位拆解

**諮詢目標**: 深度分析特定職位所需的各項能力
**操作邏輯**: 自由排列職能卡，模擬職位能力地圖
**特殊功能**: 支援截圖上傳，可與實際JD對照

### 3. 價值導航卡模式

```text
價值導航卡
├─ 價值觀排序
│   ├─ 價值卡組 (36張核心價值)
│   └─ 分層畫布 (第1/2/3名+其他層級)
└─ 生活改造王
    ├─ 價值卡組 + 生活籌碼系統
    └─ 量表畫布 (0-100滿意度+籌碼分配)
```

#### 3.1 價值觀排序（原有）

- 左側：不同價值的牌組（36張核心價值卡）
- 右側：分層排序區（第1/2/3名 + 其他層級）
- 拖曳排序，每層限制數量
- 重點突出前三名

#### 3.2 生活改造王 🎯

**諮詢目標**: 生活滿意度評估與資源重新分配
**特殊機制**: **籌碼分配系統**（100點生活能量）
**畫布設計**: 價值滿意度量表 + 籌碼投資分配

**🎲 籌碼系統設計：**

- 總籌碼：100點「生活能量」
- 分配規則：依照重要程度分配到各價值領域
- 視覺呈現：籌碼數量 = 圓點大小或數字顯示
- 約束條件：總和必須等於100

**遊戲流程：**

1. **現況評估**: 標記各價值領域的滿意度 (0-100)
2. **理想分配**: 用100個籌碼分配到各領域
3. **差距分析**: 對比滿意度與投資分配
4. **改造計畫**: 找出需要調整的領域

**籌碼互動邏輯：**

- 點擊 [+] 增加該領域籌碼
- 點擊 [-] 減少該領域籌碼
- 即時顯示剩餘籌碼數量
- 總和超過100時警告提示
- 支援拖曳籌碼在領域間轉移

## 🚀 用戶旅程設計

```text
用戶進入 → 選擇模式 → 選擇玩法 → 系統自動配置 → 開始遊戲
         (職游/職能/價值)  (1-3種)    (牌卡+畫布)
```

## 🔑 關鍵設計原則

- **🎯 單一職責**: 每個玩法只負責一種特定的咨詢目標
- **🔄 自動配置**: 用戶選擇玩法後，系統自動配置牌卡和畫布
- **🎨 專屬設計**: 每個玩法都有獨特的視覺設計和交互方式
- **📱 一致體驗**: 所有玩法共享相同的基礎操作邏輯

### 基礎操作

1. **翻牌**：點擊切換正反面
2. **拖曳**：從牌組拖到放置區
3. **查看**：長按或雙擊查看詳情
4. **註記**：諮詢師可加註解

### 牌卡狀態（詳細需求）

- **正面**：顯示牌卡標題和圖片
- **反面**：顯示牌卡詳細描述
- **檢閱詳情**：彈出詳細資訊視窗
- **dropped**：已放置到目標區域

## 資料模型（簡化版）

### User（諮詢師）

```typescript
{
  id: string
  email: string
  name: string
  password: string  // 加密
}
```

### Room（房間）

```typescript
{
  id: string
  counselorId: string
  name: string
  status: 'active' | 'expired'
  shareLink: string
  expiresAt: Date
  createdAt: Date
}
```

### Visitor（來訪者）

```typescript
{
  roomId: string
  nickname: string
  joinedAt: Date
}
```

### CardAction（操作記錄）

```typescript
{
  id: string
  roomId: string
  userId: string
  action: 'flip' | 'move' | 'annotate'
  cardId: string
  timestamp: Date
  data: JSON
}
```

## 技術決策（MVP）

### 前端

- Next.js 14（手機優先）
- Tailwind CSS（快速開發）
- @dnd-kit（拖曳功能）
- Zustand（狀態管理）

### 後端

- FastAPI（Python 3.11+）
- PostgreSQL + SQLModel
- JWT 認證
- **Supabase Realtime（即時同步） ✅ 已實作**

### 即時同步架構 ✅ 已實作

- **Supabase Broadcast** - 低延遲即時通訊
- **遊戲狀態同步** - 卡片位置、選擇狀態即時更新
- **在線狀態顯示** - 即時顯示房間內參與者
- **文字輸入同步** - 支援多人協作編輯
- 詳細架構請參考 [同步架構文件](docs/SYNC_ARCHITECTURE.md)

### 部署

- GCP Cloud Run（前後端分離部署）
- PostgreSQL on Supabase
- GitHub Actions CI/CD

## 📊 開發時程追蹤

### 第1個月實際完成（2025-09-01 ~ 09-30）

#### Week 1 ✅

- 專案架設（Next.js + FastAPI）
- 資料庫設計（PostgreSQL + Supabase）
- 諮詢師註冊/登入系統

#### Week 2 ✅

- 房間 CRUD 系統
- QR Code 分享機制
- 訪客加入流程

#### Week 3 ✅

- 七大遊戲模式實作
- 拖曳功能（@dnd-kit）
- Supabase Realtime 同步

#### Week 4 ✅

- 客戶管理系統
- Staging 環境部署
- 同步功能測試與優化

### 第2個月計畫（2025-10-01 ~ 10-31）

> 💡 **與用戶需求文件對照**：[第二個月目標與需求](https://docs.google.com/document/d/1vSz-w5ST-hQKcZ85ALZlOF-AcxHzVt6bSWvzitH4_X4/edit?tab=t.0)
>
> **關鍵發現**：用戶文件中的多項目標已在第1個月提前完成（多人同步、登入系統、CRM）

#### Week 5-6 實際完成狀況

- ✅ 牌卡視覺體驗優化（疊卡模式）- 第1個月末已完成
  - 雙視圖模式切換（List / Single）
  - 3層堆疊視覺效果
  - 大卡翻轉與索引切換
- ❌ 牌卡狀態持久化到資料庫 - 未開始
- ❌ Event Sourcing 架構實作 - 未開始
- ⚠️ 真實牌卡內容上架 - 僅有簡化版測試資料

#### Week 7-8 實際完成狀況

- ✅ 諮詢師筆記功能（選項A：手動筆記）
  - 抽屜式筆記面板
  - 即時儲存功能
- ❌ 房間狀態恢復功能 - 未開始
- ❌ 諮詢報告生成 - 未開始
- ❌ 文案細節調整優化 - 未開始

#### 額外完成項目

- ✅ CI/CD 自動化完善
  - 自動 Database migrations
  - IPv4 相容性修復
  - 多次部署流程優化
- ✅ Dashboard UI 重設計
  - 可收合側邊欄
  - 客戶管理介面改版
- ✅ RIASEC 說明卡整合
- ✅ 多項 UX 改進
  - JD 預覽優化
  - 退出諮詢室流程改善
  - 404 錯誤修復

#### 第2個月完成度（截至 Week 8）

| 項目類型 | 計劃 | 完成 | 比例 |
|---------|------|------|------|
| Week 5-6 | 4項 | 1項 | 25% |
| Week 7-8 | 4項 | 2項 | 50% |
| 額外項目 | - | 4大項 | - |
| **總計** | **8項** | **3項 + 額外** | **~45%** |

**Week 8 完成**：

- ✅ 客戶諮詢室架構簡化（一鍵進入、截圖整合、自動記錄）

**Week 9 完成 (2025-10-14)**：

- ✅ 遊戲狀態持久化系統完整實作
  - ✅ 資料庫設計：gameplay_states 表 (JSONB)
  - ✅ 後端 API：GET/PUT/DELETE 端點
  - ✅ 前端持久化 Hook：30秒自動保存
  - ✅ 雙軌存儲：Room owner (PostgreSQL) / Visitor (localStorage)
  - ✅ 所有 7 個玩法整合完成
  - ✅ 移除 Zustand localStorage persist，避免衝突

**核心待辦事項**：

- 🟡 P1：真實牌卡內容上架
- 🟡 P1：諮詢歷史查看介面
- 🟢 P2：諮詢報告生成功能

#### 與用戶需求文件對照分析（更新至 2025-10-14 Week 9）

基於 [第二個月目標與需求文件] 的對照：
<https://docs.google.com/document/d/1vSz-w5ST-hQKcZ85ALZlOF-AcxHzVt6bSWvzitH4_X4/edit>

| 用戶需求項目 | PRD 狀態 | 完成度 | 備註 |
|------------|---------|-------|------|
| **多人同步操作** | ✅ 完成 | 100% | 第1個月提前完成 |
| **登入/註冊系統** | ✅ 完成 | 100% | JWT 認證，OAuth 預留 |
| **來訪者資料管理** | ✅ 完成 | 100% | CRM 基礎版，Week 8 簡化客戶管理 UX |
| **諮詢師筆記功能** | ✅ 完成 | 90% | Week 8 整合截圖功能，報告生成待開發 |
| **牌卡視覺優化** | ✅ 完成 | 90% | 疊卡模式完成，細節待優化 |
| **牌卡資訊設計 & 圖檔上線** | ⚠️ 進行中 | 20% | **最大落差**：僅測試資料，待 Hannah 提供真實內容 |
| **UIUX 設計實作** | ⚠️ 進行中 | 80% | Week 8 客戶管理簡化完成 |
| **牌卡狀態持久化** | ✅ 完成 | 100% | **Week 9 完成**：Snapshot 模式，雙軌存儲架構 |
| **房間狀態恢復** | ✅ 完成 | 100% | **Week 9 完成**：自動載入最後狀態 |
| **自由模式（空白畫布）** | ❌ 未開始 | 0% | 需求待確認 |

**總體評估 (更新至 Week 9)**：

- ✅ **超前項目**：3項（多人同步、登入系統、CRM）
- ✅ **已完成項目**：5項（筆記功能、視覺優化、客戶管理簡化、**狀態持久化**、**狀態恢復**）
- ⚠️ **進行中項目**：2項（牌卡內容、UIUX）
- ❌ **未啟動項目**：1項（自由模式）

**Week 9 完成項目 (2025-10-14)**：

1. **遊戲狀態持久化系統**：
   - gameplay_states 資料表 (JSONB 存儲)
   - 後端 CRUD API (FastAPI)
   - 前端 useGameplayStatePersistence Hook
   - 30 秒自動保存 + unmount 保存
   - 雙軌架構：Room owner → PostgreSQL / Visitor → localStorage
   - 7 個玩法全部整合完成
   - 移除 Zustand localStorage persist，解決衝突

2. **房間狀態恢復功能**：
   - 頁面刷新後自動載入最後狀態
   - 切換玩法後保留各玩法獨立狀態
   - 退出房間再進入，狀態完整還原

**最大落差分析 (更新)**：

1. **牌卡內容上架**：用戶期望的真實牌卡圖檔與文案尚未完整上線，目前僅有測試資料
2. ~~**狀態持久化**~~：✅ Week 9 已完成
3. **自由模式**：用戶需求文件提及，但 PRD 未明確規劃

### 第2個月收尾 (2025-10-15 ~ 10-31)

> **會議決議 (2025-10-15)**：明確第一階段範圍，聚焦 Beta 測試準備

#### Week 10 (剩餘時間)

##### P0 優先：完成「卡牌仿真需求」

- ✅ 線上牌卡 = 實體牌卡操作體驗
- ⚠️ CRM 牌卡介面三版展示（小=文字、中=預覽、大=原圖）
- ⚠️ 牌卡內容上架（等 Hannah 提供資料）

##### P1 次要：籌碼系統改版

- ✅ 改用加減按鈕或數字輸入 (2025-10-16 完成)
- ✅ 取消自動平衡機制 (2025-10-16 完成)
- ✅ 每張牌卡籌碼獨立設定 (2025-10-16 完成)

##### P2 基礎建設

- ⚠️ Production 環境推送準備
- ⚠️ 白名單登入機制（無註冊/忘密碼功能）

#### Week 10 完成項目 (2025-10-16 ~ 10-17)

**完成功能：**

1. **籌碼系統改版** ✅ (2025-10-16 commit 2269cd2)
   - 移除 slider 介面，改用 +10/-10 按鈕
   - 新增手動數字輸入功能（0-100）
   - 實現拖曳重新排序（@dnd-kit/sortable）
   - 每張卡片獨立籌碼設定，無自動平衡機制
   - 圓餅圖視覺化優化：固定顏色、標籤連線、字母排序

2. **Sidebar 捲動與 Grid 修復** ✅ (2025-10-17 commit 40c7f39)
   - 修復 GameLayout 和 CardSidebar 高度約束問題
   - 替換動態 Tailwind class 為 inline style (CSS Grid)
   - 解決 sidebar 無法捲動的 bug

#### Week 11 完成項目 (2025-10-18 ~ 10-21)

**完成功能：**

1. **白名單認證系統** ✅ (2025-10-18 ~ 10-21)
   - ✅ 管理員後台介面（用戶列表、密碼重設）
   - ✅ CSV 批量匯入用戶（支援自訂密碼、自動覆蓋）
   - ✅ 單一用戶快速新增表單
   - ✅ 強制修改密碼機制（must_change_password 欄位）
   - ✅ 忘記/重設密碼流程（24小時過期 Token）
   - ✅ 防止 Email 列舉攻擊的安全設計
   - ✅ 前端認證頁面（change-password, forgot-password, reset-password）
   - ✅ TDD 測試修復與事務隔離
   - ✅ 隱藏公開註冊入口（白名單制）

2. **資料庫 Schema 更新** ✅
   - password_reset_tokens 表（Token 管理）
   - users.must_change_password 欄位（安全標記）
   - Alembic Migration 完成

### 第3個月：Beta 封測準備 (2025-11-01 ~ 11-30)

> **目標**：11-12 月上線 Beta 測試，開放職涯諮詢師使用

#### Week 11-12：Beta 測試準備

**✅ 必須完成（第一階段範圍）：**

1. **籌碼系統改版** ✅ (2025-10-16 完成)
   - ✅ 加減按鈕或數字輸入 (commit 2269cd2)
   - ✅ 移除自動平衡 (commit 2269cd2)
   - ✅ 每張牌卡獨立設定 (commit 2269cd2)

2. **白名單登入制** ✅ (2025-10-21 完成)
   - ✅ 管理員後台建立用戶功能
   - ✅ CSV 批量匯入 + 單一快速新增
   - ✅ 強制修改密碼 + 忘記/重設密碼
   - ⚠️ 負載測試：50 人同時上線（待執行）

3. **卡牌上架與測試** ⚠️
   - 真實牌卡內容完整上架（等 Hannah 提供）
   - 三版介面實作（小/中/大）
   - 內部測試驗證

4. **Production 環境建置** ✅ (2025-10-24 完成)
   - ✅ 公司 GCP 專案建立（career-creator-card）
   - ✅ Cloud Run Service 部署（frontend + backend）
   - ✅ Supabase Production Database 設定
   - ✅ GCS Bucket 配置（CDN 1年快取）
   - ✅ GitHub Actions CD Pipeline（自動部署至 Production）
   - ✅ 環境變數與 Secret 管理
   - ✅ 資料庫 Migration 流程驗證
   - ✅ 舊專案完整清理（career-creator-472207）
   - ⚠️ 監控與錯誤追蹤（Cloud Logging）待完善
   - ⚠️ 負載測試與效能調校（延至 Week 12）

**❌ 不納入第一階段：**

- AI 報告生成（延至第三階段）
- A+B=C Pattern 邏輯（視產能決定）
- 註冊流程（第二階段）

#### Week 12 完成項目 (2025-10-22 ~ 10-28)

**完成功能：**

1. **Production 環境遷移** ✅ (2025-10-24)
   - GCP 專案從個人遷移至公司（career-creator-card）
   - Production + Staging 雙環境部署
   - GCS CDN 優化（1年快取）
   - 舊專案清理（career-creator-472207 已刪除）

2. **程式碼重構（Phase 1 & 2）** ✅ (2025-10-22)
   - ConsultationArea 拆分：提取 3 個 hooks
   - ClientManagement 拆分：提取 3 個組件
   - 組件從 1000+ 行降至 200-300 行

3. **測試覆蓋完善** ✅ (2025-10-22)
   - E2E 測試重組（Playwright）
   - API 層測試新增
   - React Hooks 警告全部解決

4. **Bug 修復** ✅ (2025-10-27)
   - Demo 用戶自動建立
   - Migration 檔案命名修復

#### Week 13 完成項目 (2025-10-29 ~ 11-04)

**完成功能：**

1. **負載測試與資料庫優化** ✅ (2025-10-29 ~ 11-04)
   - ✅ 建立完整負載測試框架（Python ThreadPoolExecutor 真併發測試）
   - ✅ 50 併發訪客加入壓力測試（Staging + Production）
   - ✅ 修復 Staging Session pooler 瓶頸（port 5432 → 6543）
   - ✅ 修復 Production 連線池不足（60 → 100 connections）
   - ✅ 實現 100% 成功率（Staging: 0% → 100%, Production: 28% → 100%）
   - ✅ 響應時間優化（Staging: 60s+ → 1.9s, Production: ~5s → 4.6s）
   - ✅ 診斷工具建置（/debug/db-pool, /debug/db-test）
   - ✅ 測試報告生成（FINAL_REPORT_STAGING.md, FINAL_REPORT_PRODUCTION.md）

2. **安全性強化** ✅ (2025-10-29 ~ 11-04)
   - ✅ 強化 gitleaks 密碼偵測規則
   - ✅ 移除所有 hardcoded Supabase keys
   - ✅ 臨時測試 endpoint SECRET 保護

**待完成項目**：

- ⚠️ 牌卡內容上架（等 Hannah 提供素材）
- ⚠️ Cloud Logging 監控設定（延至 Beta 測試啟動後）

#### Week 13-14：Beta 測試啟動

- Beta 用戶上線
- 回饋收集機制
- Bug 修復與優化

---

### 第二階段規劃 (2025-12 ~ 2026-02)

> **合約期**：第二期合約（12月～隔年2月）

#### 規劃功能

1. **A+B=C Pattern 邏輯**
   - 等 KM 提供 Pattern 文件
   - 固定規則實作

2. **註冊流程優化**
   - 完整註冊機制
   - 忘記密碼功能
   - Email 驗證

3. **UX 優化**
   - 根據 Beta 測試回饋調整
   - 效能優化
   - 錯誤處理強化

4. **進階功能**
   - 諮詢報告生成
   - 班級管理系統
   - 用戶自定義內容

---

## 📌 第2個月優先級決策點

**諮詢師筆記功能選擇：**

- **選項A（手動筆記）**：技術風險低，快速上線，諮詢師完全掌控
- **選項B（AI 分析）**：技術挑戰高，開發時間長，但提供更高價值

> 建議：先實作選項A，確保基本功能可用，第3個月再加入AI增強功能

## 📝 版本紀錄

- **v5.0** (2025-11-04): 更新 Week 13 完成進度（負載測試與資料庫連線池優化）
  - ✅ 50 併發訪客負載測試完成（Staging + Production 100% 成功率）
  - ✅ 修復 Staging Session pooler 瓶頸（改用 Transaction pooler）
  - ✅ 修復 Production 連線池不足（60 → 100 connections）
  - ✅ 響應時間大幅優化（Staging: -97%, Production: -8%）
  - ✅ 建立負載測試基礎建設（測試框架、報告生成、診斷工具）
  - ✅ 安全性強化（gitleaks 規則、移除 hardcoded keys）
  - ⚠️ 牌卡內容上架與監控設定延至下週
- **v4.9** (2025-10-28): 更新 Week 12 完成進度（Production 環境遷移與程式碼品質提升）
  - ✅ Production 環境遷移完成（career-creator-card 專案）
  - ✅ 舊專案清理（career-creator-472207 已刪除）
  - ✅ GCS CDN 優化（1年快取設定）
  - ✅ 大型組件重構完成（Phase 1 & 2）
  - ✅ Demo 用戶自動建立修復
  - ✅ 測試覆蓋完善（E2E + API 層）
  - ⚠️ 負載測試與牌卡上架延至下週
- **v4.8** (2025-10-21): 更新 Week 11 完成進度與 Production 環境規劃
  - ✅ 白名單認證系統完整實作（15 commits）
  - ✅ 管理員後台、CSV 匯入、密碼重設機制
  - ⚠️ 新增 Production 環境建置詳細規劃（公司 GCP）
  - 更新 Beta 測試準備進度
- **v4.7** (2025-10-17): 更新 Week 10 完成進度
  - ✅ 籌碼系統改版完整實作（commit 2269cd2）
  - ✅ Sidebar 捲動與 Grid 佈局修復（commit 40c7f39）
  - 兩項功能均已測試通過並部署至 staging
- **v4.6** (2025-10-15): 整合 10/15 會議決議，明確 Beta 測試時程與範圍
  - 第2個月收尾計畫（Week 10）
  - 第3個月 Beta 封測準備（11月）
  - 第二階段規劃（12月～2月）
  - 籌碼系統改版需求
  - 白名單登入機制
- **v4.5** (2025-10-14): 更新 Week 9 完成進度（遊戲狀態持久化系統完整實作）
- **v4.4** (2025-10-12): 更新 Week 8 完成進度（客戶諮詢室簡化架構完成）
- **v4.3** (2025-10-11): 加入 Google Docs 文件連結與用戶需求對照分析表
- **v4.2** (2025-10-07): 更新第2個月實際完成狀況與進度分析
- **v4.1** (2025-10-01): 新增第2個月具體需求（牌卡視覺優化、內容上架、筆記功能）
- **v4.0** (2025-09-30): 重構為專案管理文件，移除UI細節，新增三階段開發計畫
- **v3.0** (2025-09-29): 加入即時同步架構
- **v2.0** (2025-09-15): 完成遊戲引擎設計
- **v1.0** (2025-09-01): 初版 PRD

---

## 📋 會議記錄

### 2025-10-15 專案方向會議

**參與者**: KM, Young
**時間**: 14:40

**關鍵決議**:

1. **Beta 測試時程**: 11-12 月上線，先給職涯諮詢師測試
2. **第一階段範圍**（至11月底）:
   - 籌碼系統改版（加減或輸入數字，取消自動平衡）
   - 白名單登入制（不做註冊/忘密碼）
   - 卡牌上架測試
   - **不併報告生成**
3. **CRM 牌卡介面**: 小中大三版（小=文字、中=預覽、大=原圖）
4. **AI 功能**: 複雜 AI 報告延至第三階段
5. **登入機制**: 白名單制，KM 給名單、Young 建帳號，測 50 人同上負載
6. **任務優先順序**:
   - P0: 完成「卡牌仿真需求」（線上牌卡=實體）
   - P1: 籌碼系統 + Production 推送
7. **第二階段**（12月～隔年2月）: A+B=C Pattern、註冊流程、UX 優化

**待辦事項**:

- KM: 提供 Pattern 文件、定義資料
- Young: 10/16 處理 beta infra 及功能（牌卡、白名單、籌碼）

---

# Detailed Specifications

## 客戶諮詢室簡化架構

> 完整技術規格：`docs/SPEC_CLIENT_ROOM_SIMPLIFICATION.md` (2025-10-11)

### 目標概要

- **前端顯示**: 一個客戶 = 一個諮詢室（簡化 UX）
- **後端架構**: 保留一對多彈性（未來擴充）
- **諮詢記錄**: 以截圖 + Snapshot 方式儲存

### 實作狀態 ✅ 已完成 (Week 8)

- ✅ 資料庫 Migration 完成
- ✅ 後端 API 完成 (GET /clients, POST /clients, POST /consultation-records)
- ✅ 前端整合完成 (Dashboard 客戶列表, ClientCard)
- ✅ 截圖功能整合至諮詢筆記抽屜
- ✅ 自動建立諮詢記錄功能 (screenshots + game_state)
- ✅ Room API 返回客戶關聯資訊 (client_id, client_name)

---

# Appendix: Weekly Reports Archive

本節包含所有開發週報的完整記錄，按時間順序排列。週報記錄了專案從啟動到當前的完整開發歷程。


---

## 週報 2025-09-27

# 週報：客戶回饋處理 & 專案現況分析

*報告期間: 2025-09-21 ~ 2025-09-27*
*報告日期: 2025-09-27*

---

## 🎯 **本週重點：客戶回饋問題處理**

### ✅ **已修復問題 (4/5)**

1. **✅ 創建諮詢房間頁面輸入框顏色** - 文字顏色設定正確，無需反白查看
2. **✅ 牌卡選擇沒反應** - 重新設計為視覺化卡片選擇器
3. **✅ wording 改善** - 卡片操作文字優化為 `查看詳細說明`/`查看職業名稱`
4. **✅ 深色模式可見性** - 修復按鈕和介面元素可見性問題

### ❌ **待處理問題 (1/5)**

1. **房間狀態『活躍』含義不清** - 缺乏清楚說明，已納入產品規劃

### 📋 **新增產品需求**

- 諮詢師-來訪者雙人互動功能設計
- 來訪者獨立操作引導說明改善
- 諮詢師同步指導操作介面

---

## 📊 **遊戲資料儲存現況**

### ✅ **使用瀏覽器本地儲存確保使用體驗**

**為何使用本地儲存:**

- ⚠️ **後端資料庫設計未完成** - 遊戲狀態、牌卡擺放位置等資料
- ✅ **前端本地儲存作為替代方案** - 確保用戶遊戲進度不會遺失
- ✅ **提供完整體驗** - 用戶可以正常進行各種遊戲模式

**目前可保存的遊戲資料:**

1. **✅ 六大性格分析**: 卡片分類結果 (喜歡/中立/討厭)
2. **✅ 優劣勢分析**: 優勢卡片和劣勢卡片擺放
3. **✅ 價值觀排序**: 9宮格排序結果
4. **✅ 職業收藏家**: 精選的職業卡片收藏
5. **✅ 成長計畫**: 技能卡片和行動卡片安排
6. **✅ 職位拆解**: 職位能力分析結果
7. **✅ 生活改造王**: 生活領域和能量點數分配

**資料保存機制:**

- ✅ **重新整理不會遺失** - 遊戲進度會自動保存
- ✅ **每個房間獨立** - 不同諮詢房間的資料不會混淆
- ⚠️ **需要後端整合** - 未來需建立資料庫同步機制

---

## 📊 **PRD MVP範圍達成現況**

### ✅ **PRD MVP範圍內 - 已完成 (85%)**

#### 1. 用戶系統 (100%)

- ✅ 諮詢師登入/註冊 + Demo帳號 + JWT認證

#### 2. 房間管理 (100%)

- ✅ 創建/編輯/刪除房間 + 分享連結/QR Code + 7天自動過期

#### 3. 基礎諮詢功能 (100%)

- ✅ 諮詢師儀表板 + 諮詢歷史記錄

#### 4. 牌卡核心功能 (100%)

- ✅ 牌卡展示系統 (完整實作)
- ✅ 拖曳操作介面 (@dnd-kit)
- ✅ 三大遊戲模式（職游旅人/職能盤點/價值導航）
- ✅ 牌卡內容資料庫 (7種遊戲完整實現)

#### 5. 三大模式完整實作

- ✅ **職游旅人卡**: 六大性格分析 + 職業收藏家
- ✅ **職能盤點卡**: 優劣勢分析 + 成長計畫 + 職位拆解
- ✅ **價值導航卡**: 價值觀排序 + 生活改造王
- ✅ 統一規則引擎架構 + 組件化設計

### ❌ **PRD MVP範圍內 - 未完成 (15%)**

#### 1. 來訪者功能

- ❌ 免註冊訪客進入
- ❌ 訪客暱稱系統
- ❌ 訪客操作權限
- ❌ 雙向即時協作

#### 2. 諮詢互動

- ❌ 諮詢師引導功能
- ❌ 牌卡操作歷史記錄
- ❌ 多人即時同步
- ❌ 諮詢筆記功能

#### 3. 後端資料庫

- ❌ 遊戲狀態資料庫設計
- ❌ 牌卡擺放位置儲存
- ❌ 諮詢歷程記錄
- ❌ 多人協作資料同步

### 🚀 **超出當月範圍 - 額外實作**

**1. 完整CRM系統** ⭐ **重大擴充**

- ✅ 企業級客戶管理（姓名/Email/電話/備註/標籤）
- ✅ 隱私控制 + 搜尋篩選功能
- **說明**: PRD只要求"簡單來訪者資訊"，實作了完整CRM

#### 2. 進階技術架構

- ✅ 複雜migration系統 + bcrypt加密 + 權限控制
- ✅ localStorage 完整持久化
- **說明**: 超出當月的"暫存到簡易資料庫"需求

---

## 💡 **關鍵洞察與修正**

### ✅ **重大發現修正**

1. **✅ 牌卡核心已完成**: 三大遊戲模式100%實現，符合PRD完整要求
2. **✅ 架構超前部署**: 統一規則引擎 + 組件化設計，具備良好擴展性
3. **✅ 狀態管理完備**: localStorage 持久化機制完整實作
4. **⚠️ 同步機制缺失**: 多人協作功能是當前主要技術債務
5. **🚀 CRM額外價值**: 雖超出範圍，但增加了商業競爭力

### 📊 **實際達成狀況**

**MVP核心功能完成度: 85%** (大幅上修)

- ✅ 用戶系統: 100%
- ✅ 房間管理: 100%
- ✅ 牌卡功能: 100%
- ❌ 來訪者系統: 0%
- ❌ 即時協作: 0%

#### 商業價值評估

- 核心諮詢功能完全可用
- 7種遊戲模式提供豐富選擇
- CRM系統增加客戶管理價值
- ✅ localStorage 確保資料持久化

---

## 📅 **下週行動計劃**

### 🔴 **第一優先級 (下週重點)**

1. **免註冊訪客系統** - 實現雙向協作基礎
2. **智能輪詢同步機制** - 多人即時互動核心
3. **客戶回饋功能** - 雙人互動介面設計

### 🟡 **第二優先級 (未來2週)**

1. **遊戲狀態統一** - 將所有遊戲改用 useGameState
2. 諮詢筆記功能 - 增強記錄能力
3. 操作歷史追蹤 - 提升分析價值

### 🟢 **第三優先級 (未來規劃)**

1. CRM功能優化 - 持續增強商業價值
2. 進階報表分析 - 未來功能
3. WebSocket 升級 - 性能提升

---

## 🎯 **週報結論**

### **本週成就**

- ✅ 客戶回饋問題 80% 修復
- ✅ 發現實際進度遠超預期 (MVP 85% 完成)
- ✅ 確認 localStorage 狀態管理完整實作
- ✅ 三大遊戲模式100%符合PRD要求

### **關鍵發現**

- **正面**: 牌卡核心功能完全符合PRD，甚至超出預期
- **正面**: 技術架構超前部署，具備良好擴展性
- **待改善**: 同步機制是唯一重大技術債務
- **商業價值**: CRM系統提供額外競爭優勢

### **下週重點**

- 🎯 **戰略轉向**: 專注於來訪者系統和即時協作
- 🎯 **MVP收尾**: 完成最後15%核心功能
- 🎯 **客戶價值**: 實現真正的雙人協作諮詢體驗

### **風險評估**

- **低風險**: 核心功能穩定，技術架構成熟
- **中風險**: 同步機制實作複雜度
- **機會**: 85%完成度，接近MVP交付階段

---
*週報版本: v2025.09.27*
*下次更新: 2025-10-04*

---

## 週報 2025-09-30

# 週報 - 2025年9月30日

## 本週完成：即時同步功能

### 測試環境

- **Staging URL**: <https://career-creator-frontend-staging-990202338378.asia-east1.run.app>

---

## 0. 前置作業

### 準備測試環境

1. **開啟兩個不同瀏覽器**（例如：Chrome + Edge 或 Chrome + Safari）
2. **瀏覽器 A（諮詢師）**：
   - 進入 staging URL
   - 登入諮詢師帳號
   - 建立新房間
   - 複製分享連結
3. **瀏覽器 B（訪客）**：
   - 貼上分享連結
   - 輸入訪客名稱加入房間
4. **確認連線**：
   - 檢查 Header 右側顯示兩個頭像
   - 確認雙方都看到相同畫面

---

## 1. Header 同步功能測試

### 在線狀態顯示

**測試步驟：**

1. 諮詢師創建房間
2. 訪客透過分享連結加入
3. 檢查 Header 右側是否顯示兩個頭像
4. 訪客關閉瀏覽器，頭像應在 3 秒內消失
5. 訪客重新加入，頭像應立即出現

**預期結果：**

- ✅ 即時顯示在線人數
- ✅ 滑鼠移到頭像顯示名稱
- ✅ 離線自動清理

---

## 2. 遊戲模式同步測試

### 模式切換同步

**測試步驟：**

1. 諮詢師選擇「職能盤點卡」
2. 訪客畫面應自動切換到相同模式
3. 諮詢師切換玩法（如：生涯盤點 → 職位分解）
4. 訪客畫面應同步切換
5. 諮詢師離開，訪客畫面會被屏蔽，等待咨詢師回來才自動解鎖

**預期結果：**

- ✅ 模式自動同步
- ✅ 訪客無法主動切換模式
- ✅ 切換時保留已放置的卡片

---

## 3. 七大玩法同步測試

### 【職游旅人卡】

#### 3.1 六大性格分析（PersonalityAnalysisGame）

**測試重點：**

- 3x3 網格佈局（RIASEC 六角模型）
- 格子間移動卡片
- **雙方皆可自由拖曳卡片**

**操作：**

1. 諮詢師拖卡到中心格 → 訪客看到同步
2. 訪客拖卡到角落格 → 諮詢師看到同步
3. 每格最多 5 張限制測試

#### 3.2 職能收集家（CareerCollectorGame）

**測試重點：**

- 單一收集區
- 最多收集 15 張
- **雙方皆可自由拖曳卡片**

**操作：**

1. 諮詢師持續加入卡片 → 訪客看到同步
2. 訪客移除任意卡片 → 諮詢師看到同步
3. 測試 15 張上限

### 【職能盤點卡】

#### 3.3 優劣勢分析（AdvantageAnalysisGame）

**測試重點：**

- 三欄式佈局（喜歡/擅長/價值）
- 跨欄移動卡片
- **雙方皆可自由拖曳卡片**

**操作：**

1. 諮詢師拖卡到「喜歡」欄 → 訪客看到同步
2. 訪客從「喜歡」移到「擅長」→ 諮詢師看到同步
3. 每欄最多 10 張限制測試

#### 3.4 成長規劃（GrowthPlanningGame）

**測試重點：**

- 技能卡 + 行動卡組合
- **雙方皆可選擇卡片**
- **文字輸入同步（僅諮詢師能編輯）**
- 自動前綴功能

**操作：**

1. 諮詢師選技能卡 → 訪客看到同步
2. 訪客選行動卡 → 諮詢師看到同步
3. 諮詢師輸入計畫文字 → 訪客即時看到（訪客無法編輯）
4. 檢查前綴格式：`【技能卡: XXX | 行動卡: XXX】`

#### 3.5 職位拆解（PositionBreakdownGame）

**測試重點：**

- 拖曳卡片到 6 個不同職位格
- 移除卡片功能
- **雙方皆可自由拖曳卡片**

**操作：**

1. 諮詢師拖卡到職位 1 → 訪客看到同步
2. 訪客拖卡到職位 2 → 諮詢師看到同步
3. 雙方都可點擊 X 移除卡片 → 即時同步

### 【價值導航卡】

#### 3.6 價值觀排序（ValueRankingGame）

**測試重點：**

- 拖曳排序功能
- 順序即時同步
- **雙方皆可自由調整排序**

**操作：**

1. 諮詢師調整排序 → 訪客看到新順序
2. 訪客調整排序 → 諮詢師看到新順序
3. 測試前 10 名排序

#### 3.7 生活改造王（LifeTransformationGame）

**測試重點：**

- 拖曳卡片到生活領域
- 雙方皆可拖曳卡片**
- 籌碼分配
- 圓餅圖即時同步更新

**操作：**

1. 諮詢師拖卡片到「健康」領域 → 訪客看到同步
2. 訪客拖卡片到「工作」領域 → 諮詢師看到同步
3. 調整「健康」籌碼到 30 → 都能看到數字更新+圓餅圖同步變化
4. 調整「工作」籌碼到 20 → 都能看到數字更新+圓餅圖同步變化
5. 檢查總和 100 點限制（超過時自動調整其他領域）
6. 確認圓餅圖顯示與籌碼分配一致

---

## 4. 拖曳視覺回饋測試

### 跨瀏覽器拖曳提示

**測試步驟：**

1. 諮詢師開始拖曳卡片
2. 訪客應看到半透明卡片跟隨
3. 訪客開始拖曳
4. 諮詢師應看到視覺提示

**預期結果：**

- ✅ 拖曳中的卡片顯示為半透明
- ✅ 顯示拖曳者名稱
- ✅ 拖曳結束後恢復正常

---

## 5. 異常情況測試

### 網路中斷恢復

1. 斷開網路 30 秒
2. 重新連接
3. 檢查狀態是否自動恢復

### 多人同時操作

1. 兩人同時拖曳不同卡片
2. 兩人同時拖曳同一張卡片
3. 檢查最後操作優先原則

---

## 已知問題

1. **極少數情況下同步延遲** - 重新整理頁面可解決
2. **大量卡片快速移動時可能掉幀** - 不影響最終同步結果

---

## 下週重點

1. 修復現有測試套件
2. 優化同步效能
3. 加入錯誤重試機制

---

## 測試建議

請使用 Chrome/Edge 最新版本，確保網路穩定

---

## 週報 2025-10-07

# 週報 - 2025年10月7日

## 本週完成：第2個月核心功能與 UX 優化

### 測試環境

- **Staging URL**: <https://career-creator-frontend-staging-990202338378.asia-east1.run.app>

---

## 👥 用戶回饋整合（美荷測試）

### ✅ 本週已處理（6/6 完成）

- **#6 牌卡排序功能** 🔴 P0 - ✅ 已完成
  - 問題：「希望右邊選的牌能夠重新排序」
  - 解決：右側區域支援拖曳重新排序，所有遊戲模式全面支援

- **#5 牌卡縮小/展開視圖** 🟡 P1 - ✅ 已完成
  - 問題：「希望右邊選的牌可以縮小一點，這樣比較好一眼看到全部」
  - 解決：新增 List/Card 雙視圖模式，一鍵切換

- **#3 調整選擇牌卡數量** 🟡 P1 - ✅ 已完成
  - 問題：「希望可以調整選擇牌卡的數量」
  - 解決：內聯編輯器（上限: [15] 張），Enter 確認或失焦保存

- **#2 刪除諮詢室功能** 🟡 P1 - ✅ 已完成
  - 問題：「希望可以刪除諮詢室」
  - 解決：Dashboard 和客戶管理添加刪除按鈕，軟刪除機制

- **#4 上傳JD顯示太小** 🟢 P2 - ✅ 已優化
  - 問題：「上傳的JD顯示太小了」
  - 解決：改善職位拆解遊戲的 JD 預覽 UX

- **#1 返回鍵誤觸問題** 🔴 P0 - ✅ 已完成
  - 問題：「不小心按返回就退出諮詢室了」
  - 解決：改用明確的「退出諮詢室」按鈕 + 確認對話框

### 🔮 未來規劃

- **#7 時間線玩法** 🟢 P2
  - 說明：新增「現在 vs 理想未來」對比視圖

---

## 📋 PM 回饋待討論事項（週會議題）

### 🔴 P0 - 嚴重 Bug

#### #2 客戶狀態切換後，諮詢室記錄消失

- **問題描述**：
  1. 進入「客戶管理」頁面
  2. 點擊 ✏️ 編輯客戶
  3. 將狀態從「活躍 (Active)」改為「暫停 (Pending)」
  4. 再改回「活躍 (Active)」
  5. 結果：過去的諮詢室記錄全部消失

- **影響**：資料遺失問題，用戶無法查看歷史諮詢記錄

- **待確認**：
  - [ ] 是資料庫查詢過濾問題？
  - [ ] 是狀態切換觸發了清理邏輯？
  - [ ] 是 RLS 權限設定問題？

- **建議處理**：立即修復

---

### 🟡 P1 - 設計決策需討論

#### #3 客戶狀態分類優化

- **目前狀態**：
  - Active（活躍）
  - Pending（待處理）
  - Archived（已封存）

- **PM 建議改為**：
  - Not started（未開始）- 新客戶，還沒開始諮詢
  - In Progress（進行中）- 正在進行諮詢
  - Paused（暫停）- 暫時中斷，未來可能繼續
  - Completed（已完成）- 諮詢結束

- **建議的狀態流轉**：

  ```text
  Not started → In Progress → Paused → In Progress → Completed
                ↓
                Completed（也可以直接結束）
  ```

- **待討論**：
  - [ ] 是否採用新的狀態分類？
  - [ ] 狀態流轉規則如何定義？
  - [ ] 如何處理現有資料的遷移？
  - [ ] 是否需要限制某些狀態轉換？

---

### 🟢 P2 - 新功能規劃

#### #1 諮詢室版本管理功能

- **PM 觀察**：
  - 同一個客戶在不同諮詢室內的卡牌結果不會同步
  - 每個諮詢室是獨立的

- **PM 建議**：
  - 既然每次諮詢可能有不同結果（例如：3/1 vs 3/15）
  - 可以做成「版本管理」功能
  - 讓諮詢師儲存多個版本，方便對照不同時期的結果
  - 例如：「小明的職業興趣測驗 - 2025/03/01 版本」vs「小明的職業興趣測驗 - 2025/03/15 版本」

- **待討論**：
  - [ ] 目前設計：每個諮詢室是否確實是獨立的？
  - [ ] 是否需要版本管理功能？
  - [ ] 如果需要，版本管理的具體需求？
    - 版本命名方式？
    - 版本比對功能？
    - 版本數量限制？
  - [ ] 還是維持現狀（每個諮詢室獨立）？

---

## 📊 本週開發成果總覽

### ✅ 核心功能完成

#### 1. **諮詢師筆記系統** ✅ (PRD 第2個月核心需求)

- ✅ 抽屜式筆記面板設計
- ✅ 即時儲存功能
- ✅ 與諮詢室整合
- ✅ UX 優化（開關流暢、內容持久化）

**PRD 對應**: 第2個月 > 諮詢師筆記功能 > 選項A（手動筆記系統）

#### 2. **牌卡重新排序功能** ✅ (用戶回饋 P0 #6)

- ✅ 右側區域支援拖曳重新排序
- ✅ 所有遊戲模式全面支援
- ✅ 即時同步排序狀態
- ✅ 符合諮詢流程需求（先選再排序）

**用戶回饋**: 「希望右邊選的牌能夠重新排序」

#### 3. **雙視圖模式** ✅ (用戶回饋 P1 #5)

- ✅ List 模式（緊湊視圖）- 僅顯示卡片標題
- ✅ Card 模式（完整卡片）- 顯示完整內容
- ✅ 一鍵切換視圖
- ✅ 解決右側區域擁擠問題

**用戶回饋**: 「希望右邊選的牌可以縮小一點，這樣比較好一眼看到全部」

#### 4. **房間退出 UX 改善** ✅ (用戶回饋 P0 #1)

- ✅ 改用明確的「退出諮詢室」按鈕（取代返回鍵）
- ✅ 添加確認對話框防止意外退出
- ✅ 僅在遊戲選擇模式顯示退出按鈕（遊戲中隱藏）
- ✅ 同步狀態顯示優化（移至 Header）

**用戶回饋**: 「不小心按返回就退出諮詢室了」

---

### 🏗️ 基礎設施與 DevOps

#### 5. **CI/CD 自動化完善** ✅

- ✅ 自動 Database migrations
- ✅ IPv4 相容性修復
- ✅ 連線池問題解決
- ✅ 多次部署流程優化
- ✅ 錯誤處理與 debug logging

**影響**: 大幅提升部署穩定性與效率

---

### 🎨 UI/UX 改進

#### 6. **Dashboard 重設計** ✅

- ✅ 可收合側邊欄
- ✅ 客戶管理介面改版
- ✅ 響應式佈局優化

#### 7. **JD 預覽優化** ✅ (用戶回饋 P2 #4)

- ✅ 改善職位拆解遊戲的 JD 預覽 UX
- ✅ 更好的閱讀體驗

**用戶回饋**: 「上傳的JD顯示太小了」

#### 8. **刪除諮詢室功能（軟刪除）** ✅ (用戶回饋 P1 #2)

- ✅ Dashboard 房間列表刪除按鈕
- ✅ 客戶管理中的房間刪除功能
- ✅ 軟刪除機制（is_active=false）
- ✅ 整合 DeleteRoomDialog
- ✅ Overview tab 移除（簡化介面）

**用戶回饋**: 「希望可以刪除諮詢室」

#### 9. **調整選擇牌卡數量** ✅ (用戶回饋 P1 #3)

- ✅ 簡化的數量編輯器 UX
- ✅ 內聯編輯（上限: [15] 張）
- ✅ Enter 確認或失焦保存
- ✅ 僅房主可編輯
- ✅ 即時更新計數器

**用戶回饋**: 「希望可以調整選擇牌卡的數量」

---

## 📈 PRD 第2個月進度更新

### 完成項目 ✅

- **牌卡視覺體驗優化** - Week 5 完成
- **諮詢師筆記功能（選項A）** - Week 7 完成
- **CI/CD 自動化完善** - Week 7 完成
- **Dashboard UI 重設計** - Week 7 完成

### 待完成項目 ❌

- **牌卡狀態持久化（Event Sourcing）** - 🔴 P0 - 預計 Week 8-9
- **真實牌卡內容上架** - 🟡 P1 - 預計 Week 9-10
- **房間狀態恢復功能** - 🟡 P1 - 預計 Week 10

---

## 🎯 下週重點（Week 8: 2025-10-08 ~ 10-14）

### 優先級 P0

1. **開始 Event Sourcing 架構**
   - 設計 card_events 資料表
   - 實作基礎事件記錄
   - 牌卡操作持久化

### 優先級 P1

1. **開始真實牌卡內容上架**
   - 牌卡圖片資源上傳
   - 文案細節調整優化
   - 內容管理系統建置

### 技術債務

1. **修復現有測試套件**
   - 更新快照測試
   - 新功能測試覆蓋
   - CI/CD 測試自動化

---

## 📌 已知問題

1. **牌卡內容尚未完整上架** - 等待內容提供
2. **Event Sourcing 未實作** - 下週開始設計

---

## 🚀 部署狀態

- ✅ Staging 環境穩定運行
- ✅ CI/CD 自動化部署正常
- ✅ Database migrations 自動執行

---

## 📝 結論

本週完成了第2個月的核心功能（諮詢師筆記），並且**100% 完成所有已規劃的用戶回饋**（6/6 項），包括所有 P0/P1/P2 優先級問題。特別是牌卡排序功能、雙視圖模式、退出確認對話框、數量調整和刪除功能，大幅提升了諮詢師的使用體驗。

**下週目標**：開始 Event Sourcing 架構實作，為牌卡狀態持久化打好基礎，並規劃真實牌卡內容上架流程。

---

## 測試建議

請使用 Chrome/Edge 最新版本測試以下新功能：

1. ✅ 諮詢師筆記抽屜（右上角圖示）
2. ✅ 牌卡重新排序（拖曳已選擇的卡片）
3. ✅ 視圖模式切換（List / Card 按鈕）
4. ✅ 牌卡數量調整（點擊數字編輯，如「上限: [15] 張」）
5. ✅ 刪除諮詢室（Dashboard 中的垃圾桶圖示）
6. ✅ 退出諮詢室確認對話框（點擊「退出諮詢室」按鈕）
7. ✅ Dashboard 可收合側邊欄
8. ✅ JD 預覽優化（職位拆解遊戲）

---

**報告產生時間**: 2025-10-07
**涵蓋期間**: 2025-09-30 ~ 2025-10-07 (Week 7)
**下次更新**: 2025-10-14

---

## 週報 2025-10-12

# 週報 - 2025年10月12日

## 本週完成：客戶諮詢體驗全面升級

### 測試環境

- **Staging URL**: <https://career-creator-frontend-staging-990202338378.asia-east1.run.app>

---

## 🎯 本週核心成果

這週我們完成了**客戶諮詢室簡化架構**，這是第2個月最重要的功能之一。讓諮詢師能更專注在諮詢本身，而非管理一堆房間。

---

## ✨ 主要功能更新

### 1. 一個客戶，一間諮詢室

**過去的困擾：**

- 同一個客戶可能有多個諮詢室
- 不知道該進哪一間
- 管理起來很混亂

**現在的體驗：**

- 每個客戶都有專屬的「主要諮詢室」
- 點擊「進入諮詢室」就直接開始
- 如果是新客戶，系統會自動建立第一間諮詢室

> 💡 **設計理念**：就像每個客戶都有自己的「諮詢空間」，進去就能繼續上次的對話。

---

### 2. 客戶管理介面簡化

**過去的做法：**

- Dashboard 的客戶管理需要展開才能看到諮詢室
- 每個客戶可能有多個諮詢室，要選擇進入哪一間
- 截圖記錄分散在各個諮詢室中

**現在的做法：**

- 簡化客戶管理介面，移除複雜的展開邏輯
- 每個客戶一個「進入諮詢室」按鈕
- 點擊後自動進入或創建該客戶的主要諮詢室

**簡化後的設計：**

- 客戶名稱與聯絡資訊一目了然
- 狀態標籤清楚顯示（活躍/暫停/已封存）
- 一鍵操作減少認知負擔

---

### 3. 截圖功能搬家了

**更好的使用體驗：**

- 截圖按鈕移到右側「諮詢筆記」抽屜
- 和筆記功能放在一起更直覺
- 截圖結果也會直接在抽屜顯示

**自動建立諮詢記錄：**

- 如果還沒建立諮詢記錄，點擊截圖時會自動建立
- 不用手動新增記錄再上傳截圖
- 一個動作完成兩件事

> 💡 **設計理念**：把相關功能放在一起，減少來回切換。

---

### 4. 諮詢記錄更完整

**截圖自動包含：**

- 諮詢師的即時筆記
- 當下的遊戲狀態
- 客戶選擇的牌卡結果

**資料存在哪裡：**

- 截圖圖片：GCP Cloud Storage（安全穩定）
- 諮詢記錄：Supabase PostgreSQL
- 自動關聯客戶與諮詢室

---

## 📈 產品體驗進化總結

### 從「房間管理」到「客戶管理」

這週的更新本質上是**思維的轉變**：

**過去的邏輯：**

```text
諮詢師 → 房間列表 → 選一個房間 → 開始諮詢
```

**現在的邏輯：**

```text
諮詢師 → 客戶列表 → 選一個客戶 → 直接開始諮詢
```

**為什麼這樣更好？**

1. **更直覺**：諮詢師關心的是「今天要見誰」，而非「要進哪個房間」
2. **更簡單**：不用思考該創建多少房間、該進哪一間
3. **更聚焦**：所有資訊圍繞「客戶」組織，而非分散在多個房間

---

### 從「手動記錄」到「自動留存」

**過去的做法：**

- 諮詢完要記得手動儲存
- 截圖和筆記是分開的
- 要自己整理諮詢記錄

**現在的做法：**

- 隨時點擊截圖，自動建立記錄
- 截圖包含筆記和牌卡狀態
- 資料自動關聯客戶

**實際場景舉例：**
> 美荷諮詢師正在和小明進行職涯探索。諮詢到一半，小明突然說：「這張卡講的就是我！」美荷立刻點開右側筆記抽屜，記下這段對話，然後點擊「儲存截圖」。系統自動把當下的牌卡畫面、筆記內容、選擇的卡片全部存起來，關聯到小明的諮詢記錄。截圖和筆記都安全儲存在雲端，下次諮詢時可以查看歷史記錄。

---

## 📊 第2個月進度檢視

### ✅ 已完成（本週）

- **客戶諮詢室簡化架構** ✅
  - 簡化客戶管理操作流程
  - 一鍵進入諮詢室（自動創建預設房間）
  - 截圖功能整合到筆記抽屜，更直覺
  - 自動儲存完整諮詢記錄（含截圖與牌卡狀態）

### ✅ 已完成（前幾週）

- **牌卡視覺體驗優化** ✅ (Week 5)
  - 雙視圖模式、拖曳排序、數量調整
- **諮詢師筆記功能** ✅ (Week 7)
  - 即時儲存、與諮詢室整合
- **Dashboard 改版** ✅ (Week 7)
  - 可收合側邊欄、響應式設計

### ⚠️ 進行中

- **牌卡內容上架** ⚠️
  - 測試資料已就位
  - 等待真實牌卡文案

### ❌ 待完成

- **牌卡狀態持久化（Event Sourcing）** ❌
  - 預計下週開始設計
  - 目標：Week 8-9 完成

---

## 🎯 下週重點（Week 9: 2025-10-15 ~ 10-21）

### 1. Event Sourcing 架構設計

- 設計 card_events 資料表
- 規劃事件記錄機制
- 實作基礎事件儲存

### 2. 真實牌卡內容整合

- 與案主確認文案格式
- 批量匯入牌卡資料
- 測試內容顯示效果

### 3. 諮詢記錄查看功能

- 客戶詳情頁面設計
- 歷史記錄展示（含截圖預覽）
- 諮詢時間軸視圖

## 💬 案主測試建議

請使用最新版 Chrome 或 Edge 測試以下流程：

### 完整諮詢流程體驗

1. **登入 Dashboard**
   - 進入 <https://career-creator-frontend-staging-990202338378.asia-east1.run.app>
   - 使用測試帳號登入

2. **查看客戶列表**
   - 看到所有客戶卡片
   - 觀察客戶資訊顯示（名稱、諮詢次數等）

3. **進入諮詢室**
   - 點擊「進入諮詢室」按鈕
   - 應該直接進入該客戶的主要諮詢室

4. **進行諮詢**
   - 選擇遊戲模式（如：職能盤點卡）
   - 拖曳牌卡進行諮詢

5. **記錄與截圖**
   - 點擊右上角「筆記」圖示
   - 輸入諮詢筆記
   - 點擊「儲存截圖」按鈕
   - 查看截圖成功訊息

6. **返回 Dashboard**
   - 退出諮詢室
   - 確認客戶資訊正常顯示

---

## 🎉 結論

本週完成了「客戶諮詢室簡化架構」，這是第2個月的重要里程碑。我們把系統從「以房間為中心」轉變為「以客戶為中心」，讓諮詢師的工作流程更直覺、更簡單。截圖與筆記功能的整合，也讓諮詢記錄的保存變得更加輕鬆自然。

**下週目標**：開始實作牌卡狀態持久化功能，讓諮詢過程能完整保存，並規劃諮詢記錄的查看介面，方便諮詢師回顧歷史記錄。

---

**報告產生時間**: 2025-10-12
**涵蓋期間**: 2025-10-08 ~ 2025-10-12 (Week 8)
**下次更新**: 2025-10-19

---

## 週報 2025-10-21

# 10月總結報告（2025-10-01 ~ 10-21）

## 測試環境

<https://career-creator-frontend-staging-990202338378.asia-east1.run.app>

---

## 📋 10月目標達成狀況

### 原定目標（5項）

| 項目 | 狀態 |
|------|------|
| 牌卡視覺優化 | ✅ 完成 |
| 牌卡狀態持久化 | ✅ 完成 |
| 牌卡內容上架 | ⚠️ 等 Hannah 提供內容 |
| 諮詢師筆記功能 | ✅ 完成 |
| 諮詢歷史管理 | ❌ 延至第二階段 |

### 會議新增目標（3項）

| 項目 | 狀態 |
|------|------|
| 籌碼系統改版 | ✅ 完成 |
| 白名單登入制 | ✅ 完成 |
| Production 環境 | ⚠️ 下週進行 |

### 額外完成（6項）

- ✅ 客戶諮詢室簡化（一鍵進入）
- ✅ 截圖功能整合（GCS Cloud Storage）
- ✅ 全站 RWD 響應式設計
- ✅ CI/CD 自動化部署
- ✅ 資料庫優化
- ✅ 籌碼系統改版（按鈕輸入、獨立設定）

### 本月交付

11 項完整功能

---

## ✅ 本月重點功能

### 1. 白名單認證系統

**管理員功能**：

- CSV 批量匯入用戶
- 單一用戶快速新增
- 一鍵密碼重設

**用戶體驗**：

- 首次登入強制修改密碼
- 忘記密碼自助重設

### 2. 遊戲狀態持久化

- 30 秒自動保存
- 刷新頁面狀態不丟失
- 7 個遊戲模式全支援

### 3. 客戶諮詢室簡化

- 從「客戶列表 → 展開房間 → 選房間 → 進入」
- 變成「客戶列表 → 進入諮詢室 → 直接開始」
- 截圖整合在筆記抽屜，一鍵儲存

### 4. 籌碼系統改版

**操作方式**：

- 移除 slider 滑桿
- 改用 +10/-10 按鈕快速調整
- 支援手動數字輸入（0-100）

**設計調整**：

- 每張牌卡獨立設定籌碼
- 取消自動平衡機制
- 拖曳重新排序
- 圓餅圖視覺優化（固定顏色、標籤連線）

---

## ⚠️ 未完成項目

### 1. 牌卡內容上架

- **阻礙**：等 Hannah（設計師）提供牌卡圖片與視覺素材
- **現況**：資料結構已完成，顯示邏輯已就位

### 2. 諮詢歷史管理

- **原因**：Beta 測試準備更優先
- **現況**：基礎資料已保存（截圖 + 筆記 + 狀態）
- **計畫**：延至第二階段（12月~2月）

### 3. Production 環境

- **現況**：Staging 環境運作正常
- **下週**：公司 GCP 環境建置

---

## 🎯 下週重點（10/22 ~ 10/28）

### P0 優先：Production 環境

- 公司 GCP Project 設定
- Cloud Run 服務部署
- Supabase Production Database
- CI/CD 自動部署
- 監控與日誌

### P1 次要：負載測試

- 建立 50 個測試帳號
- 模擬 50 人同時上線
- 效能調校

---

## 💬 需要協助

**KM（PM）**：

1. Beta 測試用戶 Email 清單（50 人）
2. 確認公司 GCP Project 權限
3. 協調 Hannah 提供牌卡素材

**Hannah（設計師）**：

1. 三種牌卡圖片資源（職游、職能、價值）
2. 牌卡視覺設計檔案
3. 建議先提供一種牌卡完整素材測試

---

## 🧪 測試驗證步驟

### 白名單認證系統測試

#### 1. CSV 批量匯入

```text
1. 登入管理員（demo.admin@example.com / demo123）
2. 進入「用戶管理」
3. 下載 CSV 範本
4. 填寫：
   email,password
   test1@example.com,Test1234
   test2@example.com,Test5678
5. 上傳 CSV
6. 查看匯入結果

預期：✅ 顯示「成功建立 2 個用戶」
```

#### 2. 單一快速新增

```text
1. 輸入 Email: test3@example.com
2. 輸入密碼: Test9999
3. 點擊「新增用戶」

預期：✅ 用戶列表出現 test3
```

#### 3. 首次登入強制修改密碼

```text
1. 使用 test1@example.com / Test1234 登入
2. 自動導向「修改密碼」頁面
3. 輸入舊密碼 Test1234，新密碼 NewPass123
4. 修改密碼

預期：✅ 修改成功，自動進入 Dashboard
```

#### 4. 忘記密碼

```text
1. 登出
2. 點擊「忘記密碼」
3. 輸入 Email: test2@example.com
4. 複製畫面顯示的 Token
5. 使用 Token 重設密碼為 ResetPass456
6. 登入驗證

預期：✅ 新密碼可登入
```

#### 5. 管理員重設密碼

```text
1. 登入管理員
2. 找到 test3 用戶
3. 點擊「重設密碼」
4. 記下新密碼
5. 使用新密碼登入 test3

預期：✅ 新密碼可登入，導向修改密碼頁面
```

### 遊戲狀態持久化測試

```text
1. 進入諮詢室
2. 選擇「職能盤點卡 - 優劣勢分析」
3. 拖曳 3 張卡片到優勢區
4. 翻轉 2 張卡片
5. 刷新頁面（F5）

預期：✅ 3 張卡片仍在優勢區，2 張保持翻轉
```

### 客戶諮詢室簡化測試

```text
1. 進入 Dashboard
2. 找到任一客戶
3. 點擊「進入諮詢室」

預期：✅ 直接進入（無需選房間）
```

### 籌碼系統測試

```text
1. 進入諮詢室
2. 選擇「價值導航卡 - 生活改造王」
3. 點擊 +10 按鈕增加籌碼
4. 手動輸入數字調整籌碼
5. 拖曳卡片重新排序
6. 查看圓餅圖視覺化

預期：✅ 籌碼可獨立調整，無自動平衡
```

---

## 📋 總結

10月交付 **11 項完整功能**（原定 3 + 新增 2 + 額外 6），
雖然「牌卡內容上架」和「諮詢歷史管理」未完成，
但完成了更關鍵的「白名單認證系統」、「遊戲狀態持久化」和「籌碼系統改版」，
**Beta 測試基礎建設就緒**。

**下週最優先**：Production 環境建置。

**請依上述步驟測試，有問題請回報。**

---

**報告時間**: 2025-10-21
**涵蓋期間**: 2025-10-01 ~ 10-21

---

## 週報 2025-10-28

# 10月第四週報告（2025-10-22 ~ 10-28）

## 測試環境

<https://career-creator-frontend-staging-990202338378.asia-east1.run.app>

---

## 📋 本週重點成果

### ✅ Production 環境遷移完成

**背景**：從個人 GCP 專案遷移到公司專案

**完成項目**：

- 新 GCP 專案建立（`career-creator-card`）
- 前後端服務部署（Production + Staging）
- 資料庫遷移（Supabase Production）
- 截圖儲存優化（GCS CDN 1年快取）
- 舊專案完整清理

**影響**：

- ✅ **成本控管**：從個人帳單轉為公司專案
- ✅ **權限管理**：團隊成員統一管理
- ✅ **環境穩定**：Production/Staging 分離運作
- ✅ **效能提升**：CDN 快取減少載入時間

---

## 🔧 程式碼品質提升

### 1. 大型組件重構（2階段完成）

**Phase 1 - 諮詢室組件拆分**：

- 將 1000+ 行的 `ConsultationArea` 拆解
- 提取 3 個獨立 hooks：
  - `useCardManagement`（牌卡操作）
  - `useTokenManagement`（籌碼系統）
  - `mockCards`（資料分離）

**Phase 2 - 客戶管理組件拆分**：

- 將 800+ 行的 `ClientManagement` 拆解
- 提取 3 個獨立組件：
  - `useClientManagement`（資料邏輯）
  - `ClientTableRow`（桌面版列表）
  - `ClientMobileCard`（手機版卡片）

**效益**：

- ✅ **可維護性**：組件從 1000+ 行降至 200-300 行
- ✅ **可測試性**：邏輯獨立，方便單元測試
- ✅ **可重用性**：Hook 可在其他組件使用

### 2. 測試覆蓋完善

**新增測試**：

- E2E 測試重組（Playwright）
- API 層測試（auth, rooms, visitors）
- 重構後煙霧測試

**修復問題**：

- React Hooks 依賴警告全部解決
- 測試選擇器更新
- 過時測試清理

---

## 🐛 功能修復

### 1. Demo 用戶自動建立

**問題**：Demo 帳號登入後無法建立客戶（缺少 user 記錄）

**解決**：

- 後端自動檢查並建立 user 記錄
- 支援 demo.counselor / demo.admin 兩種角色
- 確保 demo 帳號完整可用

### 2. 資料庫遷移修復

**問題**：Migration 檔案命名錯誤導致部署失敗

**解決**：

- 修正 Alembic migration 檔案順序
- 移除錯誤的 gameplay_states 刪除語句
- 部署流程恢復正常

---

## ⚠️ 本週未完成

### 1. 牌卡內容上架

**狀態**：等待 Hannah 提供牌卡素材
**現況**：資料結構和顯示邏輯已就位

### 2. Production 負載測試

**原因**：環境遷移花費較多時間
**計畫**：下週進行 50 人同時上線測試

---

## 🎯 下週計畫（10/29 ~ 11/04）

### P0：Beta 測試準備

1. **負載測試**
   - 建立 50 個測試帳號
   - 模擬多人同時操作
   - 監控系統效能

2. **牌卡內容上架**
   - 等待 Hannah 提供素材
   - 真實牌卡導入系統
   - 內部驗收測試

### P1：監控與優化

1. **錯誤追蹤**
   - Cloud Logging 設定
   - 異常告警機制

2. **效能調校**
   - 根據負載測試結果優化
   - 資料庫查詢優化

---

## 💬 需要協助

**KM**：

1. Beta 測試用戶清單（50 人 Email）
2. 確認 Beta 測試啟動時間
3. 協調 Hannah 提供牌卡素材進度

**Hannah**：

1. 三種牌卡圖片與文案
2. 建議優先提供一種牌卡完整測試

---

## 📊 本週數據

- **Commits**：41 個
- **重構組件**：2 個大型組件
- **新增測試**：API 測試 + E2E 重組
- **修復 Bug**：5 個
- **環境遷移**：1 個完整專案

---

## 📋 總結

本週完成 **Production 環境遷移**和**程式碼品質大幅提升**，
雖然負載測試和牌卡上架因環境遷移延後，
但系統穩定性和可維護性顯著改善，
**為 Beta 測試打下更堅實的基礎**。

**下週最優先**：負載測試 + 牌卡內容上架。

---

**報告時間**: 2025-10-28
**涵蓋期間**: 2025-10-22 ~ 10-28

---

## 週報 2025-11-04

# 11月第一週報告（2025-10-29 ~ 11-04）

## 測試環境

- Staging: <https://career-creator-frontend-staging-990202338378.asia-east1.run.app>
- Production: <https://career-creator-frontend-production-990202338378.asia-east1.run.app>

---

## 📋 本週重點成果

### ✅ 系統穩定性驗證：50 人同時使用測試通過

**為什麼重要**：

Beta 測試期間，多位諮詢師同時進行線上諮詢，若系統無法承受流量會導致：

- 來訪者無法進入房間（錯誤頁面）
- 系統卡頓或當機
- 諮詢中斷，影響專業形象

**本週完成**：

- ✅ 模擬 50 人同時加入同一個房間
- ✅ 發現並修復系統瓶頸（成功率：0%/28% → **100%**）
- ✅ 響應時間優化（60 秒 → **1.9-4.6 秒**）

**對用戶的價值**：

- 💪 諮詢不中斷，多人同時使用仍穩定
- ⚡ 1-5 秒內進入房間（原本 60 秒或失敗）
- 💰 零成本升級（系統優化，無需額外硬體）
- 🚀 放心推廣，系統可支援 200+ 人

---

### ✅ 牌卡圖片整合系統完成

**為什麼重要**：

真實牌卡圖片能大幅提升諮詢專業度：

- 數位化與實體卡片視覺一致
- 來訪者更容易理解牌卡意義
- 提升諮詢師品牌形象

**本週完成**：

- ✅ 圖片資產管理系統建置（GCS + TypeScript）
- ✅ RIASEC 六大性格卡完整整合（6張雙面卡，共12個圖片）
- ✅ 前端 Card.tsx 支援圖片顯示 + graceful fallback
- ✅ 建立完整的命名規範與擴充架構

**技術亮點**：

```text
命名規範：{deck}-{card}-{size}-{side}-{lang}.png
範例：personality-riasec-artistic-L-front-zhtw.png

支援功能：
- 多尺寸（L/M/S）
- 多語言（zhtw/en/ja/ko）
- 雙面卡片（front/back）
- Graceful fallback（無圖片時顯示文字版）
```

**對用戶的價值**：

- 🎴 RIASEC 性格分析遊戲現在可顯示真實卡片圖片
- 🔄 其他遊戲會自動 fallback 到文字版（不影響使用）
- 🚀 系統已準備好，收到圖片素材即可快速上架
- 📐 未來支援多語言、多尺寸擴充

**GCS 公開 URL**：

- Base URL: `https://storage.googleapis.com/career-creator-assets/cards/`
- 範例：[artistic-front](https://storage.googleapis.com/career-creator-assets/cards/personality-riasec-artistic-L-front-zhtw.png)

---

## 🧪 雙環境測試策略

### 為什麼要測試兩個環境？

**Staging（測試環境）= Production 的替身**：

- 🎯 專門用來測試和實驗
- 💪 可盡情測試，不怕弄壞真實資料
- 🔄 未來所有壓力測試、破壞性測試都在這裡做

**Production（正式環境）**：

- 🎯 真實用戶使用的系統
- ⚠️ 未來不可隨意測試，避免影響真實諮詢
- ✅ 本週特例：Beta 前必須驗證一次

**本週發現的問題**：

兩個環境的資料庫配置不一樣！

- Staging：配置錯誤，只能處理 15 人
- Production：配置不足，只能處理 60 人

**如果只測 Staging，會錯過 Production 的問題** → Beta 測試時真實用戶會遇到錯誤 ❌

### 測試結果對比

| 環境 | 修復前 | 修復後 | 改善 |
|------|--------|--------|------|
| **Staging 成功率** | 0% | **100%** | 從完全無法使用到所有人順利進入 |
| **Staging 速度** | 60s+ | **1.9s** | 來訪者幾乎不需等待 |
| **Production 成功率** | 28% | **100%** | 不再有人被拒於門外 |
| **Production 速度** | ~5s | **4.6s** | 進入更流暢 |

---

## 🔄 測試方法論與可重複性

### 建立的測試系統（可重複使用）

#### 1. 自動化測試腳本

`load-tests/visitor_join_test.py`

- 模擬 N 人同時加入房間
- 自動記錄成功率、響應時間、錯誤類型
- 生成完整測試報告（`test-results/FINAL_REPORT_*.md`）

#### 2. 測試 SOP（標準作業程序）

**新功能上線流程**：

1. 本地開發測試
2. 部署到 Staging → 執行測試腳本 → 確認 100% 成功
3. 部署到 Production → 小規模驗收（10 人）
4. 監控真實用戶使用

**壓力測試規則**：

- ✅ Staging：可測 50/100/200 人
- ❌ Production：不可大規模測試（避免影響真實用戶）
- ✅ 例外：重大升級前，非營業時間小規模驗證

#### 3. 未來可擴展

- 調整測試人數（10/50/100/200）
- 測試不同場景（登入/建立房間/牌卡操作）
- 整合到 CI/CD 自動執行

---

## 📊 本週投入

- 完整一週專注於系統穩定性驗證與牌卡圖片整合
- 超過 20 次負載測試
- 系統承載能力：15 人 → 200+ 人
- RIASEC 卡片整合完成（12個圖片檔案）
- 52 個 commits

---

## ⚠️ 待完成項目

### 1. 牌卡內容上架

✅ **RIASEC 六大性格卡已完成**（2025-11-04）

- ✅ 圖片資產管理系統建置（GCS + TypeScript）
- ✅ RIASEC 6張雙面卡片已上傳 GCS
- ✅ Card.tsx 支援圖片顯示 + graceful fallback
- ✅ 命名規範：`{deck}-{card}-{size}-{side}-{lang}.png`
- 📁 詳細文件：CARD_IMAGE_INTEGRATION_COMPLETE.md

⏳ **其他牌組待補充**：

等待 Hannah 提供素材（職游旅人卡、職能盤點卡、價值導航卡）

- 技術準備：✅ 完成
- 預計時程：收到素材後 1 天完成（系統已建置完成）

### 2. 系統監控

- 基礎 logging 已運作
- Beta 測試後根據實際需求優化

---

## 💬 需要協助

**KM**：

1. Beta 測試用戶清單（50 人 Email）
2. 確認 Beta 測試啟動時間（目標 11 月中）
3. 協調牌卡素材進度
4. **🆕 真人測試請求**：找 2-3 位用戶測試真實諮詢場景（15-20 分鐘）
   - 驗證連線速度、操作順暢度、同步效果、UX 直覺性

**Hannah**：

1. 三種牌卡圖片與文案（職游旅人卡、職能盤點卡、價值導航卡）
2. 建議優先提供一種牌卡完整測試

---

## 📋 總結

### 本週達成

✅ 系統穩定性驗證通過（50 人 100% 成功）
✅ 效能大幅提升（60s → 2-5s）
✅ 零額外成本
✅ 自動化測試建立
✅ 牌卡圖片整合系統完成（RIASEC 6張）

### Beta 測試準備度

| 項目 | 狀態 | 說明 |
|------|------|------|
| 系統穩定性 | ✅ | 通過 50 人壓力測試 |
| 效能優化 | ✅ | 響應時間符合預期 |
| 安全性 | ✅ | 帳號與資料保護到位 |
| 牌卡圖片系統 | ✅ | RIASEC 已完成，其他待補 |
| 牌卡其他內容 | ⏳ | 等待 Hannah 素材 |
| 用戶帳號 | ⏳ | 等待 KM 名單 |

🎉 **系統已完全準備好進行 Beta 測試**

- 可穩定支援 50+ 位諮詢師同時使用
- 每個房間可容納多位來訪者
- 所有功能運作正常，無已知重大問題

**下週最優先**：收到用戶名單 + 牌卡素材 → 立即啟動 Beta 測試 🚀

---

**報告時間**: 2025-11-04
**涵蓋期間**: 2025-10-29 ~ 11-04
