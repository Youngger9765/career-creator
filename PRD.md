# 線上牌卡系統 PRD - 專案管理紀錄

## 產品概述

**產品名稱**：線上牌卡諮詢系統
**目標用戶**：職涯諮詢師與其來訪者
**核心價值**：將實體牌卡數位化，支援遠距諮詢與資料累積

## 📚 相關文件連結

- **[第一個月進度報告]** - 詳細記錄第一個月（2025-09-01 ~ 09-30）
  完成項目與技術決策
  <https://docs.google.com/document/d/1p327JR-X3XeUxIKgkRZZfVXEWid_lTG4_rq0rVTAVuQ/edit>
- **[第二個月目標與需求]** - 第二個月（2025-10-01 ~ 10-31）
  詳細需求規格與期望目標
  <https://docs.google.com/document/d/1vSz-w5ST-hQKcZ85ALZlOF-AcxHzVt6bSWvzitH4_X4/edit>

## 🎯 三階段開發計畫

### 第1個月：MVP 核心功能

**目標**：建立可運作的原型系統

#### 必須完成 ✅

1. **諮詢師註冊登入** ✅ 已完成
2. **創建與管理房間** ✅ 已完成
3. **牌卡基本操作（翻牌、拖曳）** ✅ 已完成
4. **分享房間連結** ✅ 已完成
5. **即時同步機制** ✅ 已完成 (Supabase Realtime)
6. **三種牌卡七大玩法** ✅ 已完成

#### 未完成 ❌

1. **訪客流程優化** ⚠️ 部分完成

### 第2個月：資料持久化與諮詢功能

**目標**：完整的諮詢記錄與數據累積

#### 必須完成

1. **牌卡視覺體驗優化** ✅
   - ✅ 疊卡模式設計（放大單卡，犧牲廣度）
   - ✅ 50-100張牌卡的顯示優化
   - ✅ 拖曳選擇模式的畫面重新設計
   - ✅ 平衡單卡檢視與多卡瀏覽的需求

2. **牌卡狀態持久化** ✅ (2025-10-14 完成)
   - ✅ gameplay_states 表設計 (JSONB 存儲)
   - ✅ 自動保存機制 (30 秒間隔 + unmount)
   - ✅ 房間狀態恢復功能
   - ✅ Room owner → PostgreSQL, Visitor → localStorage
   - ✅ 支援多玩法狀態獨立保存
   - ❌ Event Sourcing 架構 (簡化為 snapshot 模式)

3. **牌卡內容上架** ⚠️ (部分完成 2025-11-04)
   - ⚠️ 真實牌卡文案導入（僅測試資料）
   - ✅ 牌卡圖片資源上傳（RIASEC 6張，2025-11-04）
   - ✅ 圖片資產管理系統建置（GCS + TypeScript）
   - ✅ 前端 graceful fallback 支援（有圖顯圖，無圖顯文字）
   - ❌ 其他牌組圖片（職游旅人卡、職能盤點卡、價值導航卡）
   - ❌ 內容管理系統建置

4. **諮詢師筆記功能** ✅
   - **✅ 選項A：手動筆記系統**（已選擇並完成）
     - ✅ 諮詢過程即時筆記
     - ⚠️ 筆記分類與標籤（基礎版）
     - ⚠️ 重要時刻標記（待完善）
   - **選項B：AI 分析系統**（留待第3個月）
     - 根據牌卡結果自動分析
     - 智慧洞察生成
     - 建議與解讀輔助

5. **諮詢歷史管理** ❌
   - ❌ 完整諮詢記錄查看
   - ❌ 歷史資料匯出
   - ❌ 諮詢報告生成

6. **客戶諮詢室架構簡化** ✅ (2025-10-11 新增，2025-10-12 完成)
   - ✅ 簡化客戶管理介面，移除展開式房間列表
   - ✅ 一鍵進入諮詢室功能（自動創建預設房間）
   - ✅ 截圖功能整合至諮詢筆記抽屜
   - ✅ 自動建立諮詢記錄（screenshots + game_state）
   - ✅ Room API 返回客戶關聯資訊（client_id, client_name）
   - ✅ 資料庫 Schema 更新（counselor_id 統一為 UUID）
   - 詳細規格：[SPEC_CLIENT_ROOM_SIMPLIFICATION.md](docs/SPEC_CLIENT_ROOM_SIMPLIFICATION.md)

### 第3個月：AI 輔助與進階功能

**目標**：智慧化輔助與規模化

#### 計畫功能

1. **AI 諮詢輔助**
   - 智慧牌卡推薦
   - 諮詢洞察分析
   - 自動生成諮詢摘要

2. **班級管理系統**
   - 多人同時諮詢
   - 群組管理功能
   - 批量報告生成

3. **用戶自定義內容**
   - 自訂牌卡內容
   - 自訂玩法規則
   - 個人化牌組管理

> **「多副牌卡」定義說明**：指在同一規則下，讓用戶可以自定義牌卡內容（如自創職業卡、自訂價值觀卡等）。MVP階段僅提供官方預設牌卡內容。
>
> **範圍調整**：三種牌卡玩法規則會全部實現，但每種規則只提供官方版本的牌卡內容，用戶自定義牌卡功能留待後續開發。

## 用戶系統架構

### 簡化架構（MVP採用）

```text
諮詢師
├── 需要註冊（Email + 密碼）
├── 可創建多個房間
└── 可查看歷史紀錄

來訪者
├── 免註冊
├── 透過連結進入
└── 輸入暱稱即可使用
```

## 🚀 目前實作狀態（2025-09-30）

### ✅ 已完成功能

1. **用戶系統** ✅
   - 諮詢師註冊/登入 (JWT)
   - Demo 帳號測試
   - 權限管理

2. **房間系統** ✅
   - 房間 CRUD 操作
   - QR Code 分享
   - 7天自動過期機制

3. **即時同步** ✅ (第2個月需求提前完成)
   - Supabase Realtime Broadcast
   - 游標同步顯示
   - 卡片移動同步
   - 卡片正反面同步

4. **遊戲引擎** ✅
   - 三大牌組完整實作
   - 七種玩法全部運作
   - 通用規則引擎

5. **客戶管理 (CRM)** ✅ (第2個月需求提前完成)
   - 來訪者基本資訊紀錄
   - 諮詢歷程追蹤
   - 時間軸檢視

### ❌ 待實作功能

1. **諮詢記錄進階功能**
   - 諮詢報告生成
   - 歷史諮詢查詢介面

2. **生產環境優化**
   - 訪客流程完善
   - 錯誤處理強化
   - 效能優化

## 頁面架構

### URL結構（詳細需求版）

```text
# 基本頁面
/                           # 首頁 / 登入畫面
/login                      # 諮詢師登入
/register                   # 諮詢師註冊
/dashboard                  # 諮詢列表 / 房間管理

# 房間系統
/rooms/create              # 新增房間
/room/[roomId]             # 房間（諮詢詳情）
/room/[roomId]?visitor=true&name=小明    # 來訪者進入

# 未來擴展（目前不實作）
/sessions                  # 諮詢列表（等同 /dashboard）
/sessions/<session_id>     # 諮詢詳情（等同 /room/[roomId]）
/sessions/<session_id>/decks/<deck_id>/plays/<play_id>  # 遊戲階層
```

### 網域架構（目標架構 vs 目前實作）

**目標架構：**

```text
第一層：諮詢師 (https://careercreator.tw/counselor1)
第二層：空間 (https://careercreator.tw/counselor1/room1)
第三層：牌卡 (https://careercreator.tw/counselor1/room1/card1)
第四層：玩法 (https://careercreator.tw/counselor1/room1/card1/play1)
```

**目前 MVP 實作：**

```text
# 簡化為單層結構，所有諮詢師共用同一個域名
/room/[roomId]  # 直接房間 ID，內建權限控制
```

**實作差異說明：**

- 目前採用簡化架構，不區分諮詢師子域名
- 權限透過登入狀態和房間創建者來控制
- 牌卡和玩法整合在房間內，不獨立分層

## 房間管理邏輯

### 房間生命週期

1. **創建**：諮詢師創建，獲得唯一ID
2. **分享**：生成短連結 + QR Code
3. **活躍**：有人在房間內操作
4. **閒置**：無人操作但仍可訪問
5. **過期**：超過有效期（預設7天）

### 權限管理

```javascript
諮詢師（房間創建者）
- 所有操作權限
- 可清空畫面
- 可結束房間

來訪者（透過連結加入）
- 可操作牌卡
- 可查看內容
- 無法刪除房間
```

## 牌卡操作功能

### 🎯 三大模式九種玩法（完整架構）

> **技術決策說明**：採用**三層通用規則引擎架構**，實現3大模式共9種玩法。參考iGaming行業最佳實踐，新玩法上線只需數天而非數週。

## 🎮 整體架構層級圖

```text
遊戲系統
│
├─ 模式選擇 (Mode)
│   ├─ 玩法選擇 (Gameplay)
│   │   ├─ 牌卡配置 (Auto)
│   │   └─ 畫布布局 (Auto)
│   └─ ...
```

## 🃏 三大模式詳細架構

### 1. 職游旅人卡模式

```text
職游旅人卡
├─ 六大性格分析
│   ├─ 6張解釋卡 (R/I/A/S/E/C)
│   └─ 三欄畫布 (喜歡/中立/討厭)
└─ 職業收藏家
    ├─ 100張職業卡
    └─ 單一收藏區 (最多15張精選)
```

#### 1.1 六大性格分析

**牌組構成**: 解釋卡6張 + 職業卡100張
**操作區域**: 三列分類區
**分類標準**: 喜歡 / 中立 / 討厭

**遊戲流程：**

1. **準備階段**: 諮詢師展示6張解釋卡，說明六大性格類型
2. **探索階段**: 來訪者從100張職業卡中選擇並分類
3. **討論階段**: 針對「喜歡」和「討厭」的職業深入對話
4. **總結階段**: 分析性格偏好與職涯方向的關聯

**區域限制：**

- 喜歡區：最多20張
- 中立區：無限制
- 討厭區：最多20張

#### 1.2 職業收藏家

**諮詢目標**: 幫助來訪者建立職業探索清單
**操作邏輯**: 從100張職業卡中精選最感興趣的15張
**畫布設計**: 單一收藏區，類似收藏夾概念

### 2. 職能盤點卡模式

```text
職能盤點卡
├─ 優劣勢分析
│   ├─ 單一職能卡組
│   └─ 雙區畫布 (優勢/劣勢)
├─ 成長計畫
│   ├─ 雙卡組 (A職能+B技能)
│   └─ 三區畫布 (A區+B區+文字註記)
└─ 職位拆解
    ├─ 單一職能卡組
    └─ 大型畫布 (自由排列+截圖上傳)
```

#### 2.1 優劣勢分析（原有）

- 左側：堆疊牌組
- 右側：兩個區域（優勢5張/劣勢5張）
- 拖曳牌卡到對應區域
- 顯示計數器（如：3/5）

#### 2.2 成長計畫

**諮詢目標**: 制定職涯發展路徑和技能提升計畫
**牌卡配置**: A組職能卡 + B組技能卡
**畫布設計**: 三區域（現有職能/目標技能/行動計畫）

#### 2.3 職位拆解

**諮詢目標**: 深度分析特定職位所需的各項能力
**操作邏輯**: 自由排列職能卡，模擬職位能力地圖
**特殊功能**: 支援截圖上傳，可與實際JD對照

### 3. 價值導航卡模式

```text
價值導航卡
├─ 價值觀排序
│   ├─ 價值卡組 (36張核心價值)
│   └─ 分層畫布 (第1/2/3名+其他層級)
└─ 生活改造王
    ├─ 價值卡組 + 生活籌碼系統
    └─ 量表畫布 (0-100滿意度+籌碼分配)
```

#### 3.1 價值觀排序（原有）

- 左側：不同價值的牌組（36張核心價值卡）
- 右側：分層排序區（第1/2/3名 + 其他層級）
- 拖曳排序，每層限制數量
- 重點突出前三名

#### 3.2 生活改造王 🎯

**諮詢目標**: 生活滿意度評估與資源重新分配
**特殊機制**: **籌碼分配系統**（100點生活能量）
**畫布設計**: 價值滿意度量表 + 籌碼投資分配

**🎲 籌碼系統設計：**

- 總籌碼：100點「生活能量」
- 分配規則：依照重要程度分配到各價值領域
- 視覺呈現：籌碼數量 = 圓點大小或數字顯示
- 約束條件：總和必須等於100

**遊戲流程：**

1. **現況評估**: 標記各價值領域的滿意度 (0-100)
2. **理想分配**: 用100個籌碼分配到各領域
3. **差距分析**: 對比滿意度與投資分配
4. **改造計畫**: 找出需要調整的領域

**籌碼互動邏輯：**

- 點擊 [+] 增加該領域籌碼
- 點擊 [-] 減少該領域籌碼
- 即時顯示剩餘籌碼數量
- 總和超過100時警告提示
- 支援拖曳籌碼在領域間轉移

## 🚀 用戶旅程設計

```text
用戶進入 → 選擇模式 → 選擇玩法 → 系統自動配置 → 開始遊戲
         (職游/職能/價值)  (1-3種)    (牌卡+畫布)
```

## 🔑 關鍵設計原則

- **🎯 單一職責**: 每個玩法只負責一種特定的咨詢目標
- **🔄 自動配置**: 用戶選擇玩法後，系統自動配置牌卡和畫布
- **🎨 專屬設計**: 每個玩法都有獨特的視覺設計和交互方式
- **📱 一致體驗**: 所有玩法共享相同的基礎操作邏輯

### 基礎操作

1. **翻牌**：點擊切換正反面
2. **拖曳**：從牌組拖到放置區
3. **查看**：長按或雙擊查看詳情
4. **註記**：諮詢師可加註解

### 牌卡狀態（詳細需求）

- **正面**：顯示牌卡標題和圖片
- **反面**：顯示牌卡詳細描述
- **檢閱詳情**：彈出詳細資訊視窗
- **dropped**：已放置到目標區域

## 資料模型（簡化版）

### User（諮詢師）

```typescript
{
  id: string
  email: string
  name: string
  password: string  // 加密
}
```

### Room（房間）

```typescript
{
  id: string
  counselorId: string
  name: string
  status: 'active' | 'expired'
  shareLink: string
  expiresAt: Date
  createdAt: Date
}
```

### Visitor（來訪者）

```typescript
{
  roomId: string
  nickname: string
  joinedAt: Date
}
```

### CardAction（操作記錄）

```typescript
{
  id: string
  roomId: string
  userId: string
  action: 'flip' | 'move' | 'annotate'
  cardId: string
  timestamp: Date
  data: JSON
}
```

## 技術決策（MVP）

### 前端

- Next.js 14（手機優先）
- Tailwind CSS（快速開發）
- @dnd-kit（拖曳功能）
- Zustand（狀態管理）

### 後端

- FastAPI（Python 3.11+）
- PostgreSQL + SQLModel
- JWT 認證
- **Supabase Realtime（即時同步） ✅ 已實作**

### 即時同步架構 ✅ 已實作

- **Supabase Broadcast** - 低延遲即時通訊
- **遊戲狀態同步** - 卡片位置、選擇狀態即時更新
- **在線狀態顯示** - 即時顯示房間內參與者
- **文字輸入同步** - 支援多人協作編輯
- 詳細架構請參考 [同步架構文件](docs/SYNC_ARCHITECTURE.md)

### 部署

- GCP Cloud Run（前後端分離部署）
- PostgreSQL on Supabase
- GitHub Actions CI/CD

## 📊 開發時程追蹤

### 第1個月實際完成（2025-09-01 ~ 09-30）

#### Week 1 ✅

- 專案架設（Next.js + FastAPI）
- 資料庫設計（PostgreSQL + Supabase）
- 諮詢師註冊/登入系統

#### Week 2 ✅

- 房間 CRUD 系統
- QR Code 分享機制
- 訪客加入流程

#### Week 3 ✅

- 七大遊戲模式實作
- 拖曳功能（@dnd-kit）
- Supabase Realtime 同步

#### Week 4 ✅

- 客戶管理系統
- Staging 環境部署
- 同步功能測試與優化

### 第2個月計畫（2025-10-01 ~ 10-31）

> 💡 **與用戶需求文件對照**：[第二個月目標與需求](https://docs.google.com/document/d/1vSz-w5ST-hQKcZ85ALZlOF-AcxHzVt6bSWvzitH4_X4/edit?tab=t.0)
>
> **關鍵發現**：用戶文件中的多項目標已在第1個月提前完成（多人同步、登入系統、CRM）

#### Week 5-6 實際完成狀況

- ✅ 牌卡視覺體驗優化（疊卡模式）- 第1個月末已完成
  - 雙視圖模式切換（List / Single）
  - 3層堆疊視覺效果
  - 大卡翻轉與索引切換
- ❌ 牌卡狀態持久化到資料庫 - 未開始
- ❌ Event Sourcing 架構實作 - 未開始
- ⚠️ 真實牌卡內容上架 - 僅有簡化版測試資料

#### Week 7-8 實際完成狀況

- ✅ 諮詢師筆記功能（選項A：手動筆記）
  - 抽屜式筆記面板
  - 即時儲存功能
- ❌ 房間狀態恢復功能 - 未開始
- ❌ 諮詢報告生成 - 未開始
- ❌ 文案細節調整優化 - 未開始

#### 額外完成項目

- ✅ CI/CD 自動化完善
  - 自動 Database migrations
  - IPv4 相容性修復
  - 多次部署流程優化
- ✅ Dashboard UI 重設計
  - 可收合側邊欄
  - 客戶管理介面改版
- ✅ RIASEC 說明卡整合
- ✅ 多項 UX 改進
  - JD 預覽優化
  - 退出諮詢室流程改善
  - 404 錯誤修復

#### 第2個月完成度（截至 Week 8）

| 項目類型 | 計劃 | 完成 | 比例 |
|---------|------|------|------|
| Week 5-6 | 4項 | 1項 | 25% |
| Week 7-8 | 4項 | 2項 | 50% |
| 額外項目 | - | 4大項 | - |
| **總計** | **8項** | **3項 + 額外** | **~45%** |

**Week 8 完成**：

- ✅ 客戶諮詢室架構簡化（一鍵進入、截圖整合、自動記錄）

**Week 9 完成 (2025-10-14)**：

- ✅ 遊戲狀態持久化系統完整實作
  - ✅ 資料庫設計：gameplay_states 表 (JSONB)
  - ✅ 後端 API：GET/PUT/DELETE 端點
  - ✅ 前端持久化 Hook：30秒自動保存
  - ✅ 雙軌存儲：Room owner (PostgreSQL) / Visitor (localStorage)
  - ✅ 所有 7 個玩法整合完成
  - ✅ 移除 Zustand localStorage persist，避免衝突

**核心待辦事項**：

- 🟡 P1：真實牌卡內容上架
- 🟡 P1：諮詢歷史查看介面
- 🟢 P2：諮詢報告生成功能

#### 與用戶需求文件對照分析（更新至 2025-10-14 Week 9）

基於 [第二個月目標與需求文件] 的對照：
<https://docs.google.com/document/d/1vSz-w5ST-hQKcZ85ALZlOF-AcxHzVt6bSWvzitH4_X4/edit>

| 用戶需求項目 | PRD 狀態 | 完成度 | 備註 |
|------------|---------|-------|------|
| **多人同步操作** | ✅ 完成 | 100% | 第1個月提前完成 |
| **登入/註冊系統** | ✅ 完成 | 100% | JWT 認證，OAuth 預留 |
| **來訪者資料管理** | ✅ 完成 | 100% | CRM 基礎版，Week 8 簡化客戶管理 UX |
| **諮詢師筆記功能** | ✅ 完成 | 90% | Week 8 整合截圖功能，報告生成待開發 |
| **牌卡視覺優化** | ✅ 完成 | 90% | 疊卡模式完成，細節待優化 |
| **牌卡資訊設計 & 圖檔上線** | ⚠️ 進行中 | 20% | **最大落差**：僅測試資料，待 Hannah 提供真實內容 |
| **UIUX 設計實作** | ⚠️ 進行中 | 80% | Week 8 客戶管理簡化完成 |
| **牌卡狀態持久化** | ✅ 完成 | 100% | **Week 9 完成**：Snapshot 模式，雙軌存儲架構 |
| **房間狀態恢復** | ✅ 完成 | 100% | **Week 9 完成**：自動載入最後狀態 |
| **自由模式（空白畫布）** | ❌ 未開始 | 0% | 需求待確認 |

**總體評估 (更新至 Week 9)**：

- ✅ **超前項目**：3項（多人同步、登入系統、CRM）
- ✅ **已完成項目**：5項（筆記功能、視覺優化、客戶管理簡化、**狀態持久化**、**狀態恢復**）
- ⚠️ **進行中項目**：2項（牌卡內容、UIUX）
- ❌ **未啟動項目**：1項（自由模式）

**Week 9 完成項目 (2025-10-14)**：

1. **遊戲狀態持久化系統**：
   - gameplay_states 資料表 (JSONB 存儲)
   - 後端 CRUD API (FastAPI)
   - 前端 useGameplayStatePersistence Hook
   - 30 秒自動保存 + unmount 保存
   - 雙軌架構：Room owner → PostgreSQL / Visitor → localStorage
   - 7 個玩法全部整合完成
   - 移除 Zustand localStorage persist，解決衝突

2. **房間狀態恢復功能**：
   - 頁面刷新後自動載入最後狀態
   - 切換玩法後保留各玩法獨立狀態
   - 退出房間再進入，狀態完整還原

**最大落差分析 (更新)**：

1. **牌卡內容上架**：用戶期望的真實牌卡圖檔與文案尚未完整上線，目前僅有測試資料
2. ~~**狀態持久化**~~：✅ Week 9 已完成
3. **自由模式**：用戶需求文件提及，但 PRD 未明確規劃

### 第2個月收尾 (2025-10-15 ~ 10-31)

> **會議決議 (2025-10-15)**：明確第一階段範圍，聚焦 Beta 測試準備

#### Week 10 (剩餘時間)

##### P0 優先：完成「卡牌仿真需求」

- ✅ 線上牌卡 = 實體牌卡操作體驗
- ⚠️ CRM 牌卡介面三版展示（小=文字、中=預覽、大=原圖）
- ⚠️ 牌卡內容上架（等 Hannah 提供資料）

##### P1 次要：籌碼系統改版

- ✅ 改用加減按鈕或數字輸入 (2025-10-16 完成)
- ✅ 取消自動平衡機制 (2025-10-16 完成)
- ✅ 每張牌卡籌碼獨立設定 (2025-10-16 完成)

##### P2 基礎建設

- ⚠️ Production 環境推送準備
- ⚠️ 白名單登入機制（無註冊/忘密碼功能）

#### Week 10 完成項目 (2025-10-16 ~ 10-17)

**完成功能：**

1. **籌碼系統改版** ✅ (2025-10-16 commit 2269cd2)
   - 移除 slider 介面，改用 +10/-10 按鈕
   - 新增手動數字輸入功能（0-100）
   - 實現拖曳重新排序（@dnd-kit/sortable）
   - 每張卡片獨立籌碼設定，無自動平衡機制
   - 圓餅圖視覺化優化：固定顏色、標籤連線、字母排序

2. **Sidebar 捲動與 Grid 修復** ✅ (2025-10-17 commit 40c7f39)
   - 修復 GameLayout 和 CardSidebar 高度約束問題
   - 替換動態 Tailwind class 為 inline style (CSS Grid)
   - 解決 sidebar 無法捲動的 bug

#### Week 11 完成項目 (2025-10-18 ~ 10-21)

**完成功能：**

1. **白名單認證系統** ✅ (2025-10-18 ~ 10-21)
   - ✅ 管理員後台介面（用戶列表、密碼重設）
   - ✅ CSV 批量匯入用戶（支援自訂密碼、自動覆蓋）
   - ✅ 單一用戶快速新增表單
   - ✅ 強制修改密碼機制（must_change_password 欄位）
   - ✅ 忘記/重設密碼流程（24小時過期 Token）
   - ✅ 防止 Email 列舉攻擊的安全設計
   - ✅ 前端認證頁面（change-password, forgot-password, reset-password）
   - ✅ TDD 測試修復與事務隔離
   - ✅ 隱藏公開註冊入口（白名單制）

2. **資料庫 Schema 更新** ✅
   - password_reset_tokens 表（Token 管理）
   - users.must_change_password 欄位（安全標記）
   - Alembic Migration 完成

### 第3個月：Beta 封測準備 (2025-11-01 ~ 11-30)

> **目標**：11-12 月上線 Beta 測試，開放職涯諮詢師使用

#### Week 11-12：Beta 測試準備

**✅ 必須完成（第一階段範圍）：**

1. **籌碼系統改版** ✅ (2025-10-16 完成)
   - ✅ 加減按鈕或數字輸入 (commit 2269cd2)
   - ✅ 移除自動平衡 (commit 2269cd2)
   - ✅ 每張牌卡獨立設定 (commit 2269cd2)

2. **白名單登入制** ✅ (2025-10-21 完成)
   - ✅ 管理員後台建立用戶功能
   - ✅ CSV 批量匯入 + 單一快速新增
   - ✅ 強制修改密碼 + 忘記/重設密碼
   - ⚠️ 負載測試：50 人同時上線（待執行）

3. **卡牌上架與測試** ⚠️
   - 真實牌卡內容完整上架（等 Hannah 提供）
   - 三版介面實作（小/中/大）
   - 內部測試驗證

4. **資料庫搬遷** ❌ (待執行)
   - ❌ 將 Staging 資料庫搬遷至公司 Supabase
   - ❌ 將 Production 資料庫搬遷至公司 Supabase
   - ❌ 更新所有環境變數與連線設定
   - ❌ 驗證資料完整性與功能正常運作

5. **Production 環境建置** ✅ (2025-10-24 完成)
   - ✅ 公司 GCP 專案建立（career-creator-card）
   - ✅ Cloud Run Service 部署（frontend + backend）
   - ✅ Supabase Production Database 設定
   - ✅ GCS Bucket 配置（CDN 1年快取）
   - ✅ GitHub Actions CD Pipeline（自動部署至 Production）
   - ✅ 環境變數與 Secret 管理
   - ✅ 資料庫 Migration 流程驗證
   - ✅ 舊專案完整清理（career-creator-472207）
   - ⚠️ 監控與錯誤追蹤（Cloud Logging）待完善
   - ⚠️ 負載測試與效能調校（延至 Week 12）

**❌ 不納入第一階段：**

- AI 報告生成（延至第三階段）
- A+B=C Pattern 邏輯（視產能決定）
- 註冊流程（第二階段）

#### Week 12 完成項目 (2025-10-22 ~ 10-28)

**完成功能：**

1. **Production 環境遷移** ✅ (2025-10-24)
   - GCP 專案從個人遷移至公司（career-creator-card）
   - Production + Staging 雙環境部署
   - GCS CDN 優化（1年快取）
   - 舊專案清理（career-creator-472207 已刪除）

2. **程式碼重構（Phase 1 & 2）** ✅ (2025-10-22)
   - ConsultationArea 拆分：提取 3 個 hooks
   - ClientManagement 拆分：提取 3 個組件
   - 組件從 1000+ 行降至 200-300 行

3. **測試覆蓋完善** ✅ (2025-10-22)
   - E2E 測試重組（Playwright）
   - API 層測試新增
   - React Hooks 警告全部解決

4. **Bug 修復** ✅ (2025-10-27)
   - Demo 用戶自動建立
   - Migration 檔案命名修復

#### Week 13 完成項目 (2025-10-29 ~ 11-04)

**完成功能：**

1. **負載測試與資料庫優化** ✅ (2025-10-29 ~ 11-04)
   - ✅ 建立完整負載測試框架（Python ThreadPoolExecutor 真併發測試）
   - ✅ 50 併發訪客加入壓力測試（Staging + Production）
   - ✅ 修復 Staging Session pooler 瓶頸（port 5432 → 6543）
   - ✅ 修復 Production 連線池不足（60 → 100 connections）
   - ✅ 實現 100% 成功率（Staging: 0% → 100%, Production: 28% → 100%）
   - ✅ 響應時間優化（Staging: 60s+ → 1.9s, Production: ~5s → 4.6s）
   - ✅ 診斷工具建置（/debug/db-pool, /debug/db-test）
   - ✅ 測試報告生成（FINAL_REPORT_STAGING.md, FINAL_REPORT_PRODUCTION.md）

2. **安全性強化** ✅ (2025-10-29 ~ 11-04)
   - ✅ 強化 gitleaks 密碼偵測規則
   - ✅ 移除所有 hardcoded Supabase keys
   - ✅ 臨時測試 endpoint SECRET 保護

**待完成項目**：

- ⚠️ 牌卡內容上架（等 Hannah 提供素材）
- ⚠️ Cloud Logging 監控設定（延至 Beta 測試啟動後）

#### Week 13-14：Beta 測試啟動

- Beta 用戶上線
- 回饋收集機制
- Bug 修復與優化

---

### 第二階段規劃 (2025-12 ~ 2026-02)

> **合約期**：第二期合約（12月～隔年2月）

#### 規劃功能

1. **A+B=C Pattern 邏輯**
   - 等 KM 提供 Pattern 文件
   - 固定規則實作

2. **註冊流程優化**
   - 完整註冊機制
   - 忘記密碼功能
   - Email 驗證

3. **UX 優化**
   - 根據 Beta 測試回饋調整
   - 效能優化
   - 錯誤處理強化

4. **進階功能**
   - 諮詢報告生成
   - 班級管理系統
   - 用戶自定義內容

---

## 📌 第2個月優先級決策點

**諮詢師筆記功能選擇：**

- **選項A（手動筆記）**：技術風險低，快速上線，諮詢師完全掌控
- **選項B（AI 分析）**：技術挑戰高，開發時間長，但提供更高價值

> 建議：先實作選項A，確保基本功能可用，第3個月再加入AI增強功能

## 📝 版本紀錄

- **v5.0** (2025-11-04): 更新 Week 13 完成進度（負載測試與資料庫連線池優化）
  - ✅ 50 併發訪客負載測試完成（Staging + Production 100% 成功率）
  - ✅ 修復 Staging Session pooler 瓶頸（改用 Transaction pooler）
  - ✅ 修復 Production 連線池不足（60 → 100 connections）
  - ✅ 響應時間大幅優化（Staging: -97%, Production: -8%）
  - ✅ 建立負載測試基礎建設（測試框架、報告生成、診斷工具）
  - ✅ 安全性強化（gitleaks 規則、移除 hardcoded keys）
  - ⚠️ 牌卡內容上架與監控設定延至下週
- **v4.9** (2025-10-28): 更新 Week 12 完成進度（Production 環境遷移與程式碼品質提升）
  - ✅ Production 環境遷移完成（career-creator-card 專案）
  - ✅ 舊專案清理（career-creator-472207 已刪除）
  - ✅ GCS CDN 優化（1年快取設定）
  - ✅ 大型組件重構完成（Phase 1 & 2）
  - ✅ Demo 用戶自動建立修復
  - ✅ 測試覆蓋完善（E2E + API 層）
  - ⚠️ 負載測試與牌卡上架延至下週
- **v4.8** (2025-10-21): 更新 Week 11 完成進度與 Production 環境規劃
  - ✅ 白名單認證系統完整實作（15 commits）
  - ✅ 管理員後台、CSV 匯入、密碼重設機制
  - ⚠️ 新增 Production 環境建置詳細規劃（公司 GCP）
  - 更新 Beta 測試準備進度
- **v4.7** (2025-10-17): 更新 Week 10 完成進度
  - ✅ 籌碼系統改版完整實作（commit 2269cd2）
  - ✅ Sidebar 捲動與 Grid 佈局修復（commit 40c7f39）
  - 兩項功能均已測試通過並部署至 staging
- **v4.6** (2025-10-15): 整合 10/15 會議決議，明確 Beta 測試時程與範圍
  - 第2個月收尾計畫（Week 10）
  - 第3個月 Beta 封測準備（11月）
  - 第二階段規劃（12月～2月）
  - 籌碼系統改版需求
  - 白名單登入機制
- **v4.5** (2025-10-14): 更新 Week 9 完成進度（遊戲狀態持久化系統完整實作）
- **v4.4** (2025-10-12): 更新 Week 8 完成進度（客戶諮詢室簡化架構完成）
- **v4.3** (2025-10-11): 加入 Google Docs 文件連結與用戶需求對照分析表
- **v4.2** (2025-10-07): 更新第2個月實際完成狀況與進度分析
- **v4.1** (2025-10-01): 新增第2個月具體需求（牌卡視覺優化、內容上架、筆記功能）
- **v4.0** (2025-09-30): 重構為專案管理文件，移除UI細節，新增三階段開發計畫
- **v3.0** (2025-09-29): 加入即時同步架構
- **v2.0** (2025-09-15): 完成遊戲引擎設計
- **v1.0** (2025-09-01): 初版 PRD

---

## 📋 會議記錄

### 2025-10-15 專案方向會議

**參與者**: KM, Young
**時間**: 14:40

**關鍵決議**:

1. **Beta 測試時程**: 11-12 月上線，先給職涯諮詢師測試
2. **第一階段範圍**（至11月底）:
   - 籌碼系統改版（加減或輸入數字，取消自動平衡）
   - 白名單登入制（不做註冊/忘密碼）
   - 卡牌上架測試
   - **不併報告生成**
3. **CRM 牌卡介面**: 小中大三版（小=文字、中=預覽、大=原圖）
4. **AI 功能**: 複雜 AI 報告延至第三階段
5. **登入機制**: 白名單制，KM 給名單、Young 建帳號，測 50 人同上負載
6. **任務優先順序**:
   - P0: 完成「卡牌仿真需求」（線上牌卡=實體）
   - P1: 籌碼系統 + Production 推送
7. **第二階段**（12月～隔年2月）: A+B=C Pattern、註冊流程、UX 優化

**待辦事項**:

- KM: 提供 Pattern 文件、定義資料
- Young: 10/16 處理 beta infra 及功能（牌卡、白名單、籌碼）
